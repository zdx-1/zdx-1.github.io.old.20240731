<!DOCTYPE html>


<html lang="zh-CN">
  

    <head>
      <meta charset="utf-8" />
        
      <meta name="description" content="learn" />
      
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1"
      />
      <title>蓝桥国赛知识梳理 |  Zdx-1</title>
  <meta name="generator" content="hexo-theme-ayer">
      
      <link rel="shortcut icon" href="/favicon.ico" />
       
<link rel="stylesheet" href="/dist/main.css">

      
<link rel="stylesheet" href="/css/fonts/remixicon.css">

      
<link rel="stylesheet" href="/css/custom.css">
 
      <script src="https://cdn.staticfile.org/pace/1.2.4/pace.min.js"></script>
       
 

      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-bulma@5.0.1/bulma.min.css"
      />
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js"></script>

      <!-- mermaid -->
      
      <style>
        .swal2-styled.swal2-confirm {
          font-size: 1.6rem;
        }
      </style>
    <link rel="alternate" href="/atom.xml" title="Zdx-1" type="application/atom+xml">
</head>
  </html>
</html>


<body>
  <div id="app">
    
      
    <main class="content on">
      <section class="outer">
  <article
  id="post-蓝桥国赛知识梳理"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h1 class="article-title sea-center" style="border-left:0" itemprop="name">
  蓝桥国赛知识梳理
</h1>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2024/05/24/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/" class="article-date">
  <time datetime="2024-05-24T03:25:08.000Z" itemprop="datePublished">2024-05-24</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%88%B7%E9%A2%98/">刷题</a> / <a class="article-category-link" href="/categories/%E5%88%B7%E9%A2%98/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B/">蓝桥国赛</a>
  </div>
  
<div class="word_count">
    <span class="post-time">
        <span class="post-meta-item-icon">
            <i class="ri-quill-pen-line"></i>
            <span class="post-meta-item-text"> 字数统计:</span>
            <span class="post-count">14.4k</span>
        </span>
    </span>

    <span class="post-time">
        &nbsp; | &nbsp;
        <span class="post-meta-item-icon">
            <i class="ri-book-open-line"></i>
            <span class="post-meta-item-text"> 阅读时长≈</span>
            <span class="post-count">77 分钟</span>
        </span>
    </span>
</div>
 
    </div>
      
    <div class="tocbot"></div>




  
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="动态规划"><a href="#动态规划" class="headerlink" title="动态规划"></a>动态规划</h1><h2 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h2><h3 id="线性DP"><a href="#线性DP" class="headerlink" title="线性DP"></a>线性DP</h3><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526132127462.png" alt="image-20240526132127462"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526132140926.png" alt="image-20240526132140926"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526132149001.png" alt="image-20240526132149001"></p>
<h4 id="动态规划分析步骤"><a href="#动态规划分析步骤" class="headerlink" title="动态规划分析步骤"></a>动态规划分析步骤</h4><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526132222766.png" alt="image-20240526132222766"></p>
<h4 id="模板题——破损的楼梯"><a href="#模板题——破损的楼梯" class="headerlink" title="模板题——破损的楼梯"></a>模板题——<a target="_blank" rel="noopener" href="https://www.lanqiao.cn/problems/3367/learning">破损的楼梯</a></h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">3367 破损的楼梯</span><br><span class="hljs-string">https://www.lanqiao.cn/problems/3367/learning</span><br><span class="hljs-string"></span><br><span class="hljs-string">这是一个典型的线性DP问题，dp[i]表示到达第i阶楼梯的方法数</span><br><span class="hljs-string">状态转移方程：dp[i]=dp[i-1]+dp[i-2]</span><br><span class="hljs-string">状态压缩：dp[i]只与dp[i-1]和dp[i-2]有关，所以可以压缩</span><br><span class="hljs-string">时间复杂度：O(n)</span><br><span class="hljs-string">空间复杂度：O(n)</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br>N = <span class="hljs-built_in">int</span>(<span class="hljs-number">1e5</span> + <span class="hljs-number">10</span>)<br>mod = <span class="hljs-built_in">int</span>(<span class="hljs-number">1e9</span> + <span class="hljs-number">7</span>)<br>n, m = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>a = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split()))<br>vis = [<span class="hljs-number">0</span>] * N<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> a: vis[i] = <span class="hljs-number">1</span><br>dp = [<span class="hljs-number">0</span>] * N<br>dp[<span class="hljs-number">0</span>] = <span class="hljs-number">1</span><br>dp[<span class="hljs-number">1</span>] = <span class="hljs-number">1</span> - vis[<span class="hljs-number">1</span>]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>, n + <span class="hljs-number">1</span>):<br>    <span class="hljs-keyword">if</span> vis[i]:<br>        <span class="hljs-keyword">continue</span><br>    dp[i] = (dp[i - <span class="hljs-number">1</span>] + dp[i - <span class="hljs-number">2</span>]) % mod<br><span class="hljs-built_in">print</span>(dp[n])<br></code></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python">n,m=<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>,<span class="hljs-built_in">input</span>().split())<br>a=<span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>,<span class="hljs-built_in">input</span>().split()))<br>dp=[<span class="hljs-number">0</span>]*(n+<span class="hljs-number">1</span>)<br>tp=[<span class="hljs-number">0</span>]*(n+<span class="hljs-number">1</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> a:<br>  tp[i]=<span class="hljs-number">1</span><br>dp[<span class="hljs-number">0</span>]=<span class="hljs-number">1</span><br>dp[<span class="hljs-number">1</span>]=<span class="hljs-number">1</span>-tp[<span class="hljs-number">1</span>]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>,n+<span class="hljs-number">1</span>):<br>  <span class="hljs-keyword">if</span> tp[i]==<span class="hljs-number">1</span>:<br>    <span class="hljs-keyword">continue</span><br>  dp[i]=dp[i-<span class="hljs-number">1</span>]+dp[i-<span class="hljs-number">2</span>]<br>mod=<span class="hljs-number">10</span>**<span class="hljs-number">9</span>+<span class="hljs-number">7</span><br><span class="hljs-built_in">print</span>(dp[i]%mod)<br></code></pre></td></tr></table></figure>
<h3 id="二维DP"><a href="#二维DP" class="headerlink" title="二维DP"></a>二维DP</h3><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526132351934.png" alt="image-20240526132351934"></p>
<h4 id="分析步骤"><a href="#分析步骤" class="headerlink" title="分析步骤"></a>分析步骤</h4><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526132407561.png" alt="image-20240526132407561"></p>
<h4 id="模板题——数字三角形"><a href="#模板题——数字三角形" class="headerlink" title="模板题——数字三角形"></a>模板题——<a target="_blank" rel="noopener" href="https://www.lanqiao.cn/problems/1536/learning">数字三角形</a></h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> sys<br><br><span class="hljs-comment"># 请在此输入您的代码</span><br>N = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>())<br>dp = [<span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(N)]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, N):<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(i + <span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">if</span> j == <span class="hljs-number">0</span>:<br>            dp[i][j] += dp[i - <span class="hljs-number">1</span>][j]<br>        <span class="hljs-keyword">elif</span> j == i:<br>            dp[i][j] += dp[i - <span class="hljs-number">1</span>][j - <span class="hljs-number">1</span>]<br>        <span class="hljs-keyword">else</span>:<br>            dp[i][j] += <span class="hljs-built_in">max</span>(dp[i - <span class="hljs-number">1</span>][j - <span class="hljs-number">1</span>], dp[i - <span class="hljs-number">1</span>][j])<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">max</span>(dp[N - <span class="hljs-number">1</span>]))<br></code></pre></td></tr></table></figure>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526132533080.png" alt="image-20240526132533080"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526132546231.png" alt="image-20240526132546231"></p>
<h4 id="模板题——摆花"><a href="#模板题——摆花" class="headerlink" title="模板题——摆花"></a>模板题——<a target="_blank" rel="noopener" href="https://www.lanqiao.cn/problems/389/learning">摆花</a></h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">n种花凑 m盆 每种&lt;a[i]</span><br><span class="hljs-string">1.分解子问题</span><br><span class="hljs-string">前i种花，一共j盆，答案是dp[n][m]</span><br><span class="hljs-string">2.状态转移</span><br><span class="hljs-string">前i种花有j盆方案数  如何由前i-1种有j盆得出.</span><br><span class="hljs-string">以下每一种选择是一种方案</span><br><span class="hljs-string">第i种花可以选0盆,前i-1种花有j盆：dp[i][j] = dp[i-1][j]</span><br><span class="hljs-string">第i种花可以选1盆,前i-1种花有j-1盆：：dp[i][j] = dp[i-1][j-1]</span><br><span class="hljs-string">...</span><br><span class="hljs-string">第i种花可以选a[i]盆,前i-1种花有j-a[i]盆：：dp[i][j] = dp[i-1][j-a[i]]</span><br><span class="hljs-string">3.边界条件，每种花都不选</span><br><span class="hljs-string">前i种花 0盆 是 一种方案 dp[i][0] = 1</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br>MOD = <span class="hljs-number">10</span> ** <span class="hljs-number">6</span> + <span class="hljs-number">7</span><br>n, m = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>a = [<span class="hljs-number">0</span>] + <span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split()))<br>dp = [[<span class="hljs-number">0</span>] * (m + <span class="hljs-number">1</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n + <span class="hljs-number">1</span>)]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n+<span class="hljs-number">1</span>):<br>    dp[i][<span class="hljs-number">0</span>] = <span class="hljs-number">1</span><br><span class="hljs-comment"># 状态转移,当下做出的选择，利用之前dp,求dp[i][j]</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,n+<span class="hljs-number">1</span>):<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,m+<span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">min</span>(a[i],j)+<span class="hljs-number">1</span>):<br>            dp[i][j]+=dp[i-<span class="hljs-number">1</span>][j-k]<br>            dp[i][j]%=MOD<br><span class="hljs-built_in">print</span>(dp[n][m])<br></code></pre></td></tr></table></figure>
<h4 id="模板题——选数异或"><a href="#模板题——选数异或" class="headerlink" title="模板题——选数异或"></a>模板题——<a target="_blank" rel="noopener" href="https://www.lanqiao.cn/problems/3711/learning">选数异或</a></h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs py">n,x = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>,<span class="hljs-built_in">input</span>().split())<br>a = [<span class="hljs-number">0</span>] + <span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>,<span class="hljs-built_in">input</span>().split()))<br>Mod = <span class="hljs-number">998244353</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string"> dp[i][j]前i个正整数有j个子序列异或成 j 的方案；答案dp[n][x]</span><br><span class="hljs-string"> dp[i][j] = 选第i个数字 + 不选第i个数字</span><br><span class="hljs-string">          = dp[i - 1][j ^ a[i]] + dp[i - 1][j]   </span><br><span class="hljs-string">          (因为如果选了第i个数字，那么a[i] ^ 前数 = j, 所以：前数 = j ^ a[i])</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br>dp = [[<span class="hljs-number">0</span>] * (<span class="hljs-number">64</span>) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n + <span class="hljs-number">1</span>)]<br><span class="hljs-comment"># 初始化为 0</span><br>dp[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] = <span class="hljs-number">1</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">64</span>):<br>        dp[i][j] = (dp[i-<span class="hljs-number">1</span>][j] + dp[i-<span class="hljs-number">1</span>][j ^ a[i]]) % Mod<br><span class="hljs-built_in">print</span>(dp[n][x])<br></code></pre></td></tr></table></figure>
<h3 id="LIS"><a href="#LIS" class="headerlink" title="LIS"></a>LIS</h3><h4 id="最长上升子序列"><a href="#最长上升子序列" class="headerlink" title="最长上升子序列"></a>最长上升子序列</h4><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526132915221.png" alt="image-20240526132915221"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526132923043.png" alt="image-20240526132923043"></p>
<h4 id="模板题——蓝桥勇士"><a href="#模板题——蓝桥勇士" class="headerlink" title="模板题——蓝桥勇士"></a>模板题——<a target="_blank" rel="noopener" href="https://www.lanqiao.cn/problems/2049/learning">蓝桥勇士</a></h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs py">n=<span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>())<br>a=[<span class="hljs-number">0</span>]+<span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>,<span class="hljs-built_in">input</span>().split()))<br>dp=[<span class="hljs-number">1</span>]*(n+<span class="hljs-number">1</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,n):<br>  <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(i+<span class="hljs-number">1</span>,n+<span class="hljs-number">1</span>):<br>    <span class="hljs-keyword">if</span> a[i]&lt;a[j]:<br>      dp[j]=<span class="hljs-built_in">max</span>(dp[j],dp[i]+<span class="hljs-number">1</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">max</span>(dp))<br></code></pre></td></tr></table></figure>
<h4 id="模板题——合唱队形"><a href="#模板题——合唱队形" class="headerlink" title="模板题——合唱队形"></a>模板题——<a target="_blank" rel="noopener" href="https://www.lanqiao.cn/problems/742/learning">合唱队形</a></h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs py">n = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>())<br>a = [<span class="hljs-number">0</span>] + <span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split()))<br>dp1 = [<span class="hljs-number">0</span>] * (n + <span class="hljs-number">1</span>)  <span class="hljs-comment"># dp1[i]表示以i结尾的最长上升子序列长度</span><br>dp2 = [<span class="hljs-number">0</span>] * (n + <span class="hljs-number">1</span>)  <span class="hljs-comment"># dp2[i]表示以i出发的最长下降子序列长度</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):<br>    dp1[i] = <span class="hljs-number">1</span><br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, i):<br>        <span class="hljs-keyword">if</span> a[i] &gt; a[j]:<br>            dp1[i] = <span class="hljs-built_in">max</span>(dp1[i], dp1[j] + <span class="hljs-number">1</span>)<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>):<br>    dp2[i] = <span class="hljs-number">1</span><br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(i + <span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">if</span> a[i] &gt; a[j]:<br>            dp2[i] = <span class="hljs-built_in">max</span>(dp2[i], dp2[j] + <span class="hljs-number">1</span>)<br><br>ans = <span class="hljs-built_in">max</span>((dp1[i] + dp2[i] - <span class="hljs-number">1</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>))<br><span class="hljs-built_in">print</span>(n-ans)<br></code></pre></td></tr></table></figure>
<h3 id="LCS"><a href="#LCS" class="headerlink" title="LCS"></a>LCS</h3><h4 id="最长公共子序列"><a href="#最长公共子序列" class="headerlink" title="最长公共子序列"></a>最长公共子序列</h4><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526133212404.png" alt="image-20240526133212404"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526133222560.png" alt="image-20240526133222560"></p>
<h4 id="模板题——最长公共子序列"><a href="#模板题——最长公共子序列" class="headerlink" title="模板题——最长公共子序列"></a>模板题——<a target="_blank" rel="noopener" href="https://www.lanqiao.cn/problems/1189/learning">最长公共子序列</a></h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-comment"># 这段代码实现的是计算两个序列（a 和 b）的最长公共子序列（Longest Common Subsequence, LCS）的长度。LCS 是一种在计算两个序列相似度时常用的度量方法。这个问题通常通过动态规划来解决。现在，我将逐步解释这段代码的各个部分：</span><br><br><span class="hljs-comment"># 输入处理</span><br>n, m = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>a = [<span class="hljs-number">0</span>] + <span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split()))<br>b = [<span class="hljs-number">0</span>] + <span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split()))<br><span class="hljs-comment"># 首先，通过 input().split() 获取两个整数 n 和 m，分别表示序列 a 和 b 的长度。</span><br><span class="hljs-comment"># 接着，读取这两个序列，并在序列前面各自加上一个 0 作为哨兵值。这样做是为了让序列的索引从 1 开始，方便后续操作。</span><br><span class="hljs-comment"># 初始化动态规划数组</span><br>dp = [[<span class="hljs-number">0</span>] * (m + <span class="hljs-number">1</span>) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>)]  <span class="hljs-comment"># 注意这里是 m，不是 n</span><br>now = <span class="hljs-number">0</span>; old = <span class="hljs-number">1</span><br><span class="hljs-comment"># 初始化一个二维动态规划数组 dp，但这里只用到了两行（range(2)），目的是节省空间。因为在计算当前状态时，只需要用到前一行（即上一状态）的数据。m + 1 是因为考虑到从 0 开始到 m 的所有可能位置。</span><br><span class="hljs-comment"># now 和 old 变量用来在这两行之间切换，表示当前行和上一行。</span><br><span class="hljs-comment"># 动态规划过程</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):<br>    now, old = old, now<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, m + <span class="hljs-number">1</span>):<br>        dp[now][j] = <span class="hljs-built_in">max</span>(dp[now][j - <span class="hljs-number">1</span>], dp[old][j])<br>        <span class="hljs-keyword">if</span> a[i] == b[j]: <br>            dp[now][j] = <span class="hljs-built_in">max</span>(dp[now][j], dp[old][j - <span class="hljs-number">1</span>] + <span class="hljs-number">1</span>)<br><span class="hljs-comment"># 这部分是动态规划的核心。</span><br><span class="hljs-comment"># 外层循环遍历序列 a，内层循环遍历序列 b。</span><br><span class="hljs-comment"># dp[now][j] = max(dp[now][j - 1], dp[old][j])：当前状态是基于之前状态的最大值，这表示如果当前字符不匹配，LCS 长度不变。</span><br><span class="hljs-comment"># 如果当前位置的字符相等（a[i] == b[j]），则检查上一个状态的值并加一，即 dp[now][j] = max(dp[now][j], dp[old][j - 1] + 1)。这反映了找到了一个公共元素，因此当前的最长公共子序列长度增加了 1。</span><br><span class="hljs-comment"># 输出结果</span><br><span class="hljs-built_in">print</span>(dp[now][m])<br><span class="hljs-comment"># 最后，打印出最长公共子序列的长度，即在遍历完两个序列后，dp 数组最后一个元素（dp[now][m]）的值。</span><br><span class="hljs-comment"># 通过这种方式，代码高效地计算了两个序列的最长公共子序列的长度，同时通过只使用两行的动态规划数组大大减少了空间复杂度。</span><br></code></pre></td></tr></table></figure>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526133424736.png" alt="image-20240526133424736"></p>
<h2 id="背包DP"><a href="#背包DP" class="headerlink" title="背包DP"></a>背包DP</h2><h3 id="01背包"><a href="#01背包" class="headerlink" title="01背包"></a>01背包</h3><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526133609206.png" alt="image-20240526133609206"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526133623292.png" alt="image-20240526133623292"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526133631379.png" alt="image-20240526133631379"></p>
<h4 id="模板题——小明的背包1"><a href="#模板题——小明的背包1" class="headerlink" title="模板题——小明的背包1"></a>模板题——<a target="_blank" rel="noopener" href="https://www.lanqiao.cn/problems/1174/learning">小明的背包1</a></h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-comment">#dp[i][j]    前i件物品，总体积不超过j 的最大价值</span><br><br>n,v=<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>,<span class="hljs-built_in">input</span>().split())<br>dp=[[<span class="hljs-number">0</span>]*(v+<span class="hljs-number">1</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n+<span class="hljs-number">1</span>)]<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,n+<span class="hljs-number">1</span>):<br>    wi,vi=<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>,<span class="hljs-built_in">input</span>().split())<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,v+<span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">if</span> j&gt;=wi:<br>            dp[i][j]=<span class="hljs-built_in">max</span>(dp[i-<span class="hljs-number">1</span>][j],dp[i-<span class="hljs-number">1</span>][j-wi]+vi)<br>        <span class="hljs-keyword">else</span>:<br>            dp[i][j]=dp[i-<span class="hljs-number">1</span>][j]<br>            <br><span class="hljs-built_in">print</span>(dp[n][v])<br></code></pre></td></tr></table></figure>
<h5 id="滚动数组优化"><a href="#滚动数组优化" class="headerlink" title="滚动数组优化"></a>滚动数组优化</h5><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526133913024.png" alt="image-20240526133913024"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526133922038.png" alt="image-20240526133922038"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526133928502.png" alt="image-20240526133928502"></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs py">n,V=<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>,<span class="hljs-built_in">input</span>().split())<br>dp=[<span class="hljs-number">0</span>]*(V+<span class="hljs-number">1</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,n+<span class="hljs-number">1</span>):<br>  w,v=<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>,<span class="hljs-built_in">input</span>().split())<br>  <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(V,w-<span class="hljs-number">1</span>,-<span class="hljs-number">1</span>):<br>    dp[j]=<span class="hljs-built_in">max</span>(dp[j],dp[j-w]+v)<br><span class="hljs-built_in">print</span>(dp[V])<br></code></pre></td></tr></table></figure>
<h3 id="完全背包"><a href="#完全背包" class="headerlink" title="完全背包"></a>完全背包</h3><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526134436937.png" alt="image-20240526134436937"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526134445527.png" alt="image-20240526134445527"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526134453737.png" alt="image-20240526134453737"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526134501798.png" alt="image-20240526134501798"></p>
<h4 id="模板题——小明的背包2"><a href="#模板题——小明的背包2" class="headerlink" title="模板题——小明的背包2"></a>模板题——<a target="_blank" rel="noopener" href="https://www.lanqiao.cn/problems/1175/learning">小明的背包2</a></h4><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526134640485.png" alt="image-20240526134640485"></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-comment"># dp[i][j]=max(dp[i-1][j],dp[i][j-wi]+vi)  不取或在先前基础上取第i种（所以可以取多次）</span><br><br>n,v=<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>,<span class="hljs-built_in">input</span>().split())<br>dp=[[<span class="hljs-number">0</span>]*(v+<span class="hljs-number">1</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n+<span class="hljs-number">1</span>)]<br><span class="hljs-keyword">for</span>  i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,n+<span class="hljs-number">1</span>):<br>    wi,vi=<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>,<span class="hljs-built_in">input</span>().split())<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,v+<span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">if</span> (j&gt;=wi):<br>            dp[i][j]=<span class="hljs-built_in">max</span>(dp[i-<span class="hljs-number">1</span>][j],dp[i][j-wi]+vi)<br>        <span class="hljs-keyword">else</span>:<br>            dp[i][j]=dp[i-<span class="hljs-number">1</span>][j]<br><span class="hljs-built_in">print</span>(dp[n][v])<br></code></pre></td></tr></table></figure>
<h5 id="滚动数组优化-1"><a href="#滚动数组优化-1" class="headerlink" title="滚动数组优化"></a>滚动数组优化</h5><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> sys<br>N, V = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>items = []<br><span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(N):<br>    w, v = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>    items.append((w, v))<br>dp = [<span class="hljs-number">0</span>] * (V + <span class="hljs-number">1</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, V + <span class="hljs-number">1</span>):<br>    <span class="hljs-keyword">for</span> w, v <span class="hljs-keyword">in</span> items:<br>        <span class="hljs-keyword">if</span> i &gt;= w:<br>            dp[i] = <span class="hljs-built_in">max</span>(dp[i], dp[i - w] + v)<br><span class="hljs-built_in">print</span>(dp[V])<br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">读取输入的商场物品数量N和小明的背包容量V，以及每种物品的体积和价值。</span><br><span class="hljs-string">初始化一个长度为V+1的动态规划数组dp，dp[i]表示背包容量为i时所能获得的最大价值。</span><br><span class="hljs-string">使用动态规划求解，外层循环遍历背包容量从1到V，内层循环遍历每种物品，更新dp[i]的值为dp[i-w]+v和当前dp[i]的较大值。</span><br><span class="hljs-string">输出dp[V]即为小明所能获得的最大价值。</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br></code></pre></td></tr></table></figure>
<h3 id="多重背包"><a href="#多重背包" class="headerlink" title="多重背包"></a>多重背包</h3><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526134702358.png" alt="image-20240526134702358"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526134710379.png" alt="image-20240526134710379"></p>
<h4 id="模板题——小明的背包3"><a href="#模板题——小明的背包3" class="headerlink" title="模板题——小明的背包3"></a>模板题——<a target="_blank" rel="noopener" href="https://www.lanqiao.cn/problems/1176/learning">小明的背包3</a></h4><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526134904431.png" alt="image-20240526134904431"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526134915203.png" alt="image-20240526134915203"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526134922223.png" alt="image-20240526134922223"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526134930677.png" alt="image-20240526134930677"></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-comment">#dp[i][j] =max(dp[i][j],dp[i-1][j-k*wi]+k*vi)  k属于(0，si)</span><br><br>n,v=<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>,<span class="hljs-built_in">input</span>().split())<br>dp=[[<span class="hljs-number">0</span>]*(v+<span class="hljs-number">1</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n+<span class="hljs-number">1</span>)]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,n+<span class="hljs-number">1</span>):<br>    wi,vi,si=<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>,<span class="hljs-built_in">input</span>().split())<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,v+<span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">min</span>(si,j//wi)+<span class="hljs-number">1</span>):<br><br>            dp[i][j]=<span class="hljs-built_in">max</span>(dp[i][j],dp[i-<span class="hljs-number">1</span>][j-k*wi]+k*vi)<br><br><span class="hljs-built_in">print</span>(dp[n][v])<br></code></pre></td></tr></table></figure>
<h5 id="滚动数组优化-2"><a href="#滚动数组优化-2" class="headerlink" title="滚动数组优化"></a>滚动数组优化</h5><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs py">N,V=<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>,<span class="hljs-built_in">input</span>().split())<br>w,v,s=[[<span class="hljs-number">0</span>]*(N+<span class="hljs-number">1</span>) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>)]<br>dp=[<span class="hljs-number">0</span> <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(V+<span class="hljs-number">1</span>)]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,N+<span class="hljs-number">1</span>):<br>  w[i],v[i],s[i]=<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>,<span class="hljs-built_in">input</span>().split())<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,N+<span class="hljs-number">1</span>):<br>  <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(s[i]):<br>    <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(V,<span class="hljs-number">0</span>,-<span class="hljs-number">1</span>):<br>      <span class="hljs-keyword">if</span> w[i]&lt;=k:<br>        dp[k]=<span class="hljs-built_in">max</span>(dp[k-w[i]]+v[i],dp[k])<br><span class="hljs-built_in">print</span>(dp[-<span class="hljs-number">1</span>])<br></code></pre></td></tr></table></figure>
<h3 id="二维费用背包-amp-分组背包"><a href="#二维费用背包-amp-分组背包" class="headerlink" title="二维费用背包&amp;分组背包"></a>二维费用背包&amp;分组背包</h3><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526135531593.png" alt="image-20240526135531593"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526135538566.png" alt="image-20240526135538566"></p>
<h4 id="模板题——小蓝的神秘行囊"><a href="#模板题——小蓝的神秘行囊" class="headerlink" title="模板题——小蓝的神秘行囊"></a>模板题——<a target="_blank" rel="noopener" href="https://www.lanqiao.cn/problems/3937/learning">小蓝的神秘行囊</a></h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> sys<br><br>n, v, m = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, sys.stdin.readline().split())<br>dp = [[<span class="hljs-number">0</span>]*(v + <span class="hljs-number">1</span>) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m + <span class="hljs-number">1</span>)]<br><span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>    volume, mass, value = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, sys.stdin.readline().split())<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(v, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>):<br>            <span class="hljs-keyword">if</span> i &gt;= mass <span class="hljs-keyword">and</span> j &gt;= volume:<br>                dp[i][j] = <span class="hljs-built_in">max</span>(dp[i][j], dp[i-mass][j-volume] + value)<br><span class="hljs-built_in">print</span>(dp[m][v])<br></code></pre></td></tr></table></figure>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs py">n,v,m=<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>,<span class="hljs-built_in">input</span>().split())<br>dp=[[<span class="hljs-number">0</span>]*(m+<span class="hljs-number">1</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(v+<span class="hljs-number">1</span>)]<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,n+<span class="hljs-number">1</span>):<br>    vi,mi,wi=<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>,<span class="hljs-built_in">input</span>().split())<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(v,vi-<span class="hljs-number">1</span>,-<span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m,mi-<span class="hljs-number">1</span>,-<span class="hljs-number">1</span>):<br>            dp[j][k] =<span class="hljs-built_in">max</span>(dp[j][k],dp[j-vi][k-mi]+wi)<br>           <br><span class="hljs-built_in">print</span>(dp[v][m])<br></code></pre></td></tr></table></figure>
<h2 id="树形DP"><a href="#树形DP" class="headerlink" title="树形DP"></a>树形DP</h2><h3 id="自上而下树形DP"><a href="#自上而下树形DP" class="headerlink" title="自上而下树形DP"></a>自上而下树形DP</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> defaultdict<br><br>n = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>())<br>val = [<span class="hljs-number">0</span>] + [<span class="hljs-built_in">int</span>(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">input</span>().split()]<br>edges = defaultdict(<span class="hljs-built_in">list</span>)<br>f = [[<span class="hljs-number">0</span>, val[i]] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n + <span class="hljs-number">1</span>)]<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add_edge</span>(<span class="hljs-params">from_node, to_node</span>):<br>    edges[from_node].append(to_node)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">dfs</span>(<span class="hljs-params">u, fa</span>):<br>    <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> edges[u]:<br>        <span class="hljs-keyword">if</span> v == fa:<br>            <span class="hljs-keyword">continue</span><br>        dfs(v, u)<br>        f[u][<span class="hljs-number">0</span>] += <span class="hljs-built_in">max</span>(f[v][<span class="hljs-number">0</span>], f[v][<span class="hljs-number">1</span>])<br>        f[u][<span class="hljs-number">1</span>] += f[v][<span class="hljs-number">0</span>]<br><br><span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n - <span class="hljs-number">1</span>):<br>    u, v = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>    add_edge(u, v)<br>    add_edge(v, u)<br><br>dfs(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">max</span>(f[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>], f[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>]))<br></code></pre></td></tr></table></figure>
<h3 id="自下而上树形DP"><a href="#自下而上树形DP" class="headerlink" title="自下而上树形DP"></a>自下而上树形DP</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> defaultdict<br><br>N = <span class="hljs-number">100005</span><br>a = [<span class="hljs-number">0</span>]*N<br>dp = [[<span class="hljs-number">0</span>]*<span class="hljs-number">2</span> <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(N)]<br>e = defaultdict(<span class="hljs-built_in">list</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">dfs</span>(<span class="hljs-params">u</span>):<br>    <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> e[u]:<br>        dfs(v)<br>        dp[u][<span class="hljs-number">1</span>] += dp[v][<span class="hljs-number">0</span>]<br>        dp[u][<span class="hljs-number">0</span>] += <span class="hljs-built_in">max</span>(dp[v])<br>    dp[u][<span class="hljs-number">1</span>] += a[u]<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-keyword">global</span> N, a, dp, e<br>    n = <span class="hljs-built_in">int</span>(sys.stdin.readline())<br>    st = <span class="hljs-built_in">set</span>(<span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n+<span class="hljs-number">1</span>))<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n+<span class="hljs-number">1</span>):<br>        a[i] = <span class="hljs-built_in">int</span>(sys.stdin.readline())<br>    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n):<br>        x, y = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, sys.stdin.readline().split())<br>        e[y].append(x)<br>        st.discard(x)<br>    rt = st.pop()<br>    dfs(rt)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">max</span>(dp[rt]))<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br></code></pre></td></tr></table></figure>
<h3 id="路径相关树形DP"><a href="#路径相关树形DP" class="headerlink" title="路径相关树形DP"></a>路径相关树形DP</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs py">N = <span class="hljs-number">2005</span><br>e = [[] <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(N)]<br>w = [[] <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(N)]<br>dp = [<span class="hljs-number">0</span>]*N<br>n, m, k = <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span><br>dep = [<span class="hljs-number">0</span>]*N<br>f = [<span class="hljs-number">0</span>]*N<br>t = []<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">dfs</span>(<span class="hljs-params">u</span>):<br>    <span class="hljs-keyword">global</span> dp, e, w<br>    <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> e[u]:<br>        dfs(v)<br>        dp[u] += dp[v]<br>    <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> w[u]:<br>        <span class="hljs-built_in">sum</span> = dp[u]<br>        <span class="hljs-keyword">for</span> nw <span class="hljs-keyword">in</span> t[<span class="hljs-string">&#x27;vec&#x27;</span>]:<br>            <span class="hljs-built_in">sum</span> -= dp[nw]<br>            <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> e[nw]:<br>                <span class="hljs-built_in">sum</span> += dp[v]<br>        dp[u] = <span class="hljs-built_in">max</span>(dp[u], <span class="hljs-built_in">sum</span> + t[<span class="hljs-string">&#x27;val&#x27;</span>])<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-keyword">global</span> n, m, f, e, dep, dp, w, t<br>    n, m = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>, n+<span class="hljs-number">1</span>):<br>        f[i] = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>())<br>        e[f[i]].append(i)<br>        dep[i] = dep[f[i]] + <span class="hljs-number">1</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, m+<span class="hljs-number">1</span>):<br>        x, y, val = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>        t.clear()<br>        <span class="hljs-keyword">while</span> x != y:<br>            <span class="hljs-keyword">if</span> dep[x] &gt; dep[y]:<br>                t.append(x)<br>                x = f[x]<br>            <span class="hljs-keyword">else</span>:<br>                t.append(y)<br>                y = f[y]<br>        t.append(x)<br>        w[x].append(&#123;<span class="hljs-string">&#x27;vec&#x27;</span>: <span class="hljs-built_in">list</span>(t), <span class="hljs-string">&#x27;val&#x27;</span>: val&#125;)<br>    dfs(<span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(dp[<span class="hljs-number">1</span>])<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br></code></pre></td></tr></table></figure>
<h3 id="换根DP"><a href="#换根DP" class="headerlink" title="换根DP"></a>换根DP</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> defaultdict<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">dfs</span>(<span class="hljs-params">u, dep, fa</span>):  <span class="hljs-comment"># 传入当前节点u,深度，父节点</span><br>    <span class="hljs-keyword">global</span> sum_depth<br>    sum_depth += dep  <span class="hljs-comment"># 加上当前节点u的深度</span><br>    <span class="hljs-comment"># 遍历u的所有子节点</span><br>    <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> e[u]:<br>        <span class="hljs-keyword">if</span> v == fa:<br>            <span class="hljs-keyword">continue</span><br>        dfs(v, dep + <span class="hljs-number">1</span>, u)  <span class="hljs-comment"># 遍历到子节点</span><br>        siz[u] += siz[v]  <span class="hljs-comment"># 通过这一步，可以统计u所有子节点数</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">dfs2</span>(<span class="hljs-params">u, fa</span>):  <span class="hljs-comment"># 用来跟新其余节点为根的解</span><br>    <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> e[u]:<br>        <span class="hljs-keyword">if</span> v == fa:<br>            <span class="hljs-keyword">continue</span><br>        <span class="hljs-comment"># dp[v] = dp[u] - siz[v] + (n - siz[v])</span><br>        dp[v] = dp[u] - <span class="hljs-number">2</span> * siz[v] + n  <span class="hljs-comment"># 当前节点v的解=左边变化值+右边变化值</span><br>        dfs2(v, u)<br><br><br>n = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>())<br>dp = [<span class="hljs-number">0</span>] * (n + <span class="hljs-number">1</span>)  <span class="hljs-comment"># 用来更新不同节点为根时的深度和</span><br>siz = [<span class="hljs-number">1</span>] * (n + <span class="hljs-number">1</span>)  <span class="hljs-comment"># 以i为根节点，其左子树的节点数，初始值为1表示仅包含该节点</span><br><span class="hljs-comment"># 建树</span><br>e = defaultdict(<span class="hljs-built_in">list</span>)<br><span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n - <span class="hljs-number">1</span>):<br>    u, v = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>    e[u].append(v)<br>    e[v].append(u)<br><span class="hljs-comment"># 第一遍dfs,找到以1为根节点的深度和</span><br>sum_depth = <span class="hljs-number">0</span>  <span class="hljs-comment"># 用来记录深度和</span><br>dfs(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)<br><span class="hljs-comment"># 第二遍dfs，求出其余点作为根的答案</span><br>dp[<span class="hljs-number">1</span>] = sum_depth  <span class="hljs-comment"># 6</span><br>dfs2(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>)  <span class="hljs-comment"># dp=[0, 6, 5, 9, 8, 8]</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">max</span>(dp))<br></code></pre></td></tr></table></figure>
<h2 id="区间DP"><a href="#区间DP" class="headerlink" title="区间DP"></a>区间DP</h2><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526140152840.png" alt="image-20240526140152840"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526140205963.png" alt="image-20240526140205963"></p>
<h3 id="普通区间DP"><a href="#普通区间DP" class="headerlink" title="普通区间DP"></a>普通区间DP</h3><h4 id="模板题——石子合并"><a href="#模板题——石子合并" class="headerlink" title="模板题——石子合并"></a>模板题——<a target="_blank" rel="noopener" href="https://www.lanqiao.cn/problems/1233/learning">石子合并</a></h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs py">n = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>())<br>a = [<span class="hljs-number">0</span>] + <span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split()))<br>f = [[<span class="hljs-built_in">float</span>(<span class="hljs-string">&#x27;inf&#x27;</span>)] * (n+<span class="hljs-number">1</span>) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n+<span class="hljs-number">1</span>)]<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n+<span class="hljs-number">1</span>):<br>    f[i][i] = <span class="hljs-number">0</span><br>    a[i] += a[i-<span class="hljs-number">1</span>]<br><br><span class="hljs-keyword">for</span> length <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>, n+<span class="hljs-number">1</span>):<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n-length+<span class="hljs-number">2</span>):<br>        j = i + length - <span class="hljs-number">1</span><br>        <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(i, j):<br>            f[i][j] = <span class="hljs-built_in">min</span>(f[i][j], f[i][k] + f[k+<span class="hljs-number">1</span>][j] + a[j] - a[i-<span class="hljs-number">1</span>])<br><br><span class="hljs-built_in">print</span>(f[<span class="hljs-number">1</span>][n])<br></code></pre></td></tr></table></figure>
<h4 id="模板题——涂色"><a href="#模板题——涂色" class="headerlink" title="模板题——涂色"></a>模板题——<a target="_blank" rel="noopener" href="https://www.lanqiao.cn/problems/926/learning">涂色</a></h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs py">s = <span class="hljs-built_in">input</span>()<br>n = <span class="hljs-built_in">len</span>(s)<br>f = [[<span class="hljs-built_in">float</span>(<span class="hljs-string">&#x27;inf&#x27;</span>)] * n <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n)]<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>    f[i][i] = <span class="hljs-number">1</span><br><br><span class="hljs-keyword">for</span> length <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>, n+<span class="hljs-number">1</span>):<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n - length + <span class="hljs-number">1</span>):<br>        j = i + length - <span class="hljs-number">1</span><br>        <span class="hljs-keyword">if</span> s[i] == s[j]:<br>            f[i][j] = <span class="hljs-built_in">min</span>(f[i + <span class="hljs-number">1</span>][j], f[i][j - <span class="hljs-number">1</span>])<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(i, i + length - <span class="hljs-number">1</span>):<br>                f[i][j] = <span class="hljs-built_in">min</span>(f[i][j], f[i][k] + f[k + <span class="hljs-number">1</span>][j])<br><br><span class="hljs-built_in">print</span>(f[<span class="hljs-number">0</span>][n - <span class="hljs-number">1</span>])<br></code></pre></td></tr></table></figure>
<h4 id="模板题——制作回文串"><a href="#模板题——制作回文串" class="headerlink" title="模板题——制作回文串"></a>模板题——<a target="_blank" rel="noopener" href="https://www.lanqiao.cn/problems/1547/learning">制作回文串</a></h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs py">m, n = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>s = <span class="hljs-built_in">input</span>()<br>w1 = [<span class="hljs-number">0</span>] * <span class="hljs-number">30</span><br>w2 = [<span class="hljs-number">0</span>] * <span class="hljs-number">30</span><br>f = [[<span class="hljs-number">0</span>] * n <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n)]<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m):<br>    ch, weight1, weight2 = <span class="hljs-built_in">input</span>().split()<br>    w1[<span class="hljs-built_in">ord</span>(ch) - <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;a&#x27;</span>)] = <span class="hljs-built_in">int</span>(weight1)<br>    w2[<span class="hljs-built_in">ord</span>(ch) - <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;a&#x27;</span>)] = <span class="hljs-built_in">int</span>(weight2)<br><br><span class="hljs-keyword">for</span> length <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>, n+<span class="hljs-number">1</span>):<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n - length + <span class="hljs-number">1</span>):<br>        j = i + length - <span class="hljs-number">1</span><br>        <span class="hljs-keyword">if</span> s[i] == s[j]:<br>            <span class="hljs-keyword">if</span> length == <span class="hljs-number">2</span>:<br>                f[i][j] = <span class="hljs-number">0</span><br>            <span class="hljs-keyword">else</span>:<br>                f[i][j] = f[i + <span class="hljs-number">1</span>][j - <span class="hljs-number">1</span>]<br>        <span class="hljs-keyword">else</span>:<br>            f[i][j] = <span class="hljs-built_in">min</span>(<br>                f[i + <span class="hljs-number">1</span>][j] + <span class="hljs-built_in">min</span>(w1[<span class="hljs-built_in">ord</span>(s[i]) - <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;a&#x27;</span>)], w2[<span class="hljs-built_in">ord</span>(s[i]) - <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;a&#x27;</span>)]),<br>                f[i][j - <span class="hljs-number">1</span>] + <span class="hljs-built_in">min</span>(w1[<span class="hljs-built_in">ord</span>(s[j]) - <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;a&#x27;</span>)], w2[<span class="hljs-built_in">ord</span>(s[j]) - <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;a&#x27;</span>)])<br>            )<br><br><span class="hljs-built_in">print</span>(f[<span class="hljs-number">0</span>][n - <span class="hljs-number">1</span>])<br></code></pre></td></tr></table></figure>
<h3 id="环形区间DP"><a href="#环形区间DP" class="headerlink" title="环形区间DP"></a>环形区间DP</h3><h4 id="模板题——能量项链"><a href="#模板题——能量项链" class="headerlink" title="模板题——能量项链"></a>模板题——<a target="_blank" rel="noopener" href="https://www.lanqiao.cn/problems/557/learning">能量项链</a></h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs py">n = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>())<br>v = [<span class="hljs-number">0</span>] * (<span class="hljs-number">2</span> * n + <span class="hljs-number">2</span>)<br>a = [<span class="hljs-number">0</span>] + <span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split()))<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):<br>    v[i] = a[i]<br>    v[i + n] = v[i]<br><br>f = [[<span class="hljs-number">0</span>] * (<span class="hljs-number">2</span> * n + <span class="hljs-number">1</span>) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span> * n + <span class="hljs-number">1</span>)]<br><br><span class="hljs-keyword">for</span> length <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>, n + <span class="hljs-number">1</span>):<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span> * n - length + <span class="hljs-number">2</span>):<br>        j = i + length - <span class="hljs-number">1</span><br>        <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(i, j):<br>            f[i][j] = <span class="hljs-built_in">max</span>(f[i][j], f[i][k] + f[k + <span class="hljs-number">1</span>][j] + v[i] * v[k + <span class="hljs-number">1</span>] * v[j + <span class="hljs-number">1</span>])<br><br>ans = <span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):<br>    ans = <span class="hljs-built_in">max</span>(ans, f[i][i + n - <span class="hljs-number">1</span>])<br><br><span class="hljs-built_in">print</span>(ans)<br></code></pre></td></tr></table></figure>
<h2 id="状压DP"><a href="#状压DP" class="headerlink" title="状压DP"></a>状压DP</h2><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526141319988.png" alt="image-20240526141319988"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526141327177-1716704007699-3.png" alt="image-20240526141327177"></p>
<h4 id="模板题——例1"><a href="#模板题——例1" class="headerlink" title="模板题——例1"></a>模板题——例1</h4><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526141355192.png" alt="image-20240526141355192"><br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs py">MAXN = <span class="hljs-number">105</span><br>N, M, K = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>a = [<span class="hljs-number">0</span>] * MAXN<br>f = [<span class="hljs-built_in">float</span>(<span class="hljs-string">&#x27;inf&#x27;</span>)] * (<span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">20</span>)<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(N):<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split()):<br>        a[i] |= <span class="hljs-number">1</span> &lt;&lt; (j - <span class="hljs-number">1</span>)<br><br>f[<span class="hljs-number">0</span>] = <span class="hljs-number">0</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(N):<br>    <span class="hljs-keyword">for</span> S <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span> &lt;&lt; M):<br>        <span class="hljs-keyword">if</span> f[S] &gt; MAXN:<br>            <span class="hljs-keyword">continue</span><br>        f[S | a[i]] = <span class="hljs-built_in">min</span>(f[S | a[i]], f[S] + <span class="hljs-number">1</span>)<br><br><span class="hljs-built_in">print</span>(f[(<span class="hljs-number">1</span> &lt;&lt; M) - <span class="hljs-number">1</span>] <span class="hljs-keyword">if</span> f[(<span class="hljs-number">1</span> &lt;&lt; M) - <span class="hljs-number">1</span>] &lt; MAXN <span class="hljs-keyword">else</span> -<span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure></p>
<h4 id="模板题——例2"><a href="#模板题——例2" class="headerlink" title="模板题——例2"></a>模板题——例2</h4><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526141422932.png" alt="image-20240526141422932"></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> math<br><br>maxn = <span class="hljs-number">2100000</span><br>f = [<span class="hljs-built_in">float</span>(<span class="hljs-string">&#x27;inf&#x27;</span>)] * maxn<br>lowbit = [<span class="hljs-number">0</span>] * maxn<br>line = [[<span class="hljs-number">0</span>] * <span class="hljs-number">20</span> <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">20</span>)]<br>x = [<span class="hljs-number">0.0</span>] * maxn<br>y = [<span class="hljs-number">0.0</span>] * maxn<br>eps = <span class="hljs-number">1e-8</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">equ</span>(<span class="hljs-params">a1, b1, c1, a2, b2, c2</span>):<br>    y = (a1 * c2 - a2 * c1) / (a1 * b2 - a2 * b1)<br>    x = (c1 - b1 * y) / a1<br>    <span class="hljs-keyword">return</span> x, y<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, (<span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">18</span>)):<br>    j = <span class="hljs-number">1</span><br>    <span class="hljs-keyword">while</span> (i &amp; (<span class="hljs-number">1</span> &lt;&lt; (j - <span class="hljs-number">1</span>))):<br>        j += <span class="hljs-number">1</span><br>    lowbit[i] = j<br><br>n = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>())<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):<br>    x[i], y[i] = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">float</span>, <span class="hljs-built_in">input</span>().split())<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">if</span> math.isclose(x[i], x[j], abs_tol=eps):<br>            <span class="hljs-keyword">continue</span><br>        a, b = equ(x[i] * x[i], x[i], y[i], x[j] * x[j], x[j], y[j])<br>        <span class="hljs-keyword">if</span> math.isclose(a, <span class="hljs-number">0</span>, abs_tol=eps):<br>            <span class="hljs-keyword">continue</span><br>        <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):<br>            <span class="hljs-keyword">if</span> math.isclose(a * x[k] * x[k] + b * x[k], y[k], abs_tol=eps):<br>                line[i][j] |= (<span class="hljs-number">1</span> &lt;&lt; (k - <span class="hljs-number">1</span>))<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, (<span class="hljs-number">1</span> &lt;&lt; n)):<br>    j = lowbit[i]<br>    f[i | (<span class="hljs-number">1</span> &lt;&lt; (j - <span class="hljs-number">1</span>))] = <span class="hljs-built_in">min</span>(f[i | (<span class="hljs-number">1</span> &lt;&lt; (j - <span class="hljs-number">1</span>))], f[i] + <span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):<br>        f[i | line[j][k]] = <span class="hljs-built_in">min</span>(f[i | line[j][k]], f[i] + <span class="hljs-number">1</span>)<br><br><span class="hljs-built_in">print</span>(f[(<span class="hljs-number">1</span> &lt;&lt; n) - <span class="hljs-number">1</span>])<br></code></pre></td></tr></table></figure>
<h2 id="数位DP"><a href="#数位DP" class="headerlink" title="数位DP"></a>数位DP</h2><h2 id="期望DP"><a href="#期望DP" class="headerlink" title="期望DP"></a>期望DP</h2><h1 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h1><h2 id="链表，栈，队列"><a href="#链表，栈，队列" class="headerlink" title="链表，栈，队列"></a>链表，栈，队列</h2><h3 id="链表"><a href="#链表" class="headerlink" title="链表"></a>链表</h3><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240524154910861.png" alt="image-20240524154910861"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240524154926348.png" alt="image-20240524154926348"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240524154959997.png" alt="image-20240524154959997"></p>
<h4 id="模板题——约瑟夫环"><a href="#模板题——约瑟夫环" class="headerlink" title="模板题——约瑟夫环"></a>模板题——<a target="_blank" rel="noopener" href="https://www.lanqiao.cn/problems/1111/learning">约瑟夫环</a></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python">n,k,m=<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>,<span class="hljs-built_in">input</span>().split())<br>a=<span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,n+<span class="hljs-number">1</span>))<br>i=k-<span class="hljs-number">1</span><br><span class="hljs-keyword">while</span> a:<br>    i=(i+(m-<span class="hljs-number">1</span>))%<span class="hljs-built_in">len</span>(a)<br>    <span class="hljs-built_in">print</span>(a.pop(i))<br></code></pre></td></tr></table></figure>
<h3 id="栈"><a href="#栈" class="headerlink" title="栈"></a>栈</h3><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240524155117734.png" alt="image-20240524155117734"></p>
<h4 id="模板题——小蓝的括号串1"><a href="#模板题——小蓝的括号串1" class="headerlink" title="模板题——小蓝的括号串1"></a>模板题——<a target="_blank" rel="noopener" href="https://www.lanqiao.cn/problems/2490/learning">小蓝的括号串1</a></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python">n=<span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>())<br>s=<span class="hljs-built_in">input</span>()<br>a=[]<br>ok=<span class="hljs-literal">True</span><br><span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> s:<br>    <span class="hljs-keyword">if</span> c == <span class="hljs-string">&#x27;(&#x27;</span>:<br>        a.append(c)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(a) == <span class="hljs-number">0</span>:<br>            ok = <span class="hljs-literal">False</span><br>            <span class="hljs-keyword">break</span><br>        a.pop()<br><span class="hljs-keyword">if</span> ok <span class="hljs-keyword">and</span> <span class="hljs-built_in">len</span>(a) == <span class="hljs-number">0</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Yes&#x27;</span>)<br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;No&#x27;</span>)<br></code></pre></td></tr></table></figure>
<h3 id="队列"><a href="#队列" class="headerlink" title="队列"></a>队列</h3><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240524173345373.png" alt="image-20240524173345373"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240524173355058.png" alt="image-20240524173355058"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240524173423272.png" alt="image-20240524173423272"></p>
<h4 id="模板题——队列操作"><a href="#模板题——队列操作" class="headerlink" title="模板题——队列操作"></a>模板题——<a target="_blank" rel="noopener" href="https://www.lanqiao.cn/problems/1519/learning/">队列操作</a></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python">N=<span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>())<br>a=[]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(N):<br>    s=<span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>,<span class="hljs-built_in">input</span>().split()))<br>    <span class="hljs-keyword">if</span> s[<span class="hljs-number">0</span>]==<span class="hljs-number">1</span>:<br>        a.append(s[<span class="hljs-number">1</span>])<br>    <span class="hljs-keyword">elif</span> s[<span class="hljs-number">0</span>]==<span class="hljs-number">2</span>:<br>        <span class="hljs-keyword">if</span> a:<br>            <span class="hljs-built_in">print</span>(a.pop(<span class="hljs-number">0</span>))<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;no&quot;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-built_in">len</span>(a))<br></code></pre></td></tr></table></figure>
<h2 id="堆"><a href="#堆" class="headerlink" title="堆"></a>堆</h2><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240524175734507.png" alt="image-20240524175734507"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240524175709055.png" alt="image-20240524175709055"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240524180001397.png" alt="image-20240524180001397"></p>
<h3 id="优先队列"><a href="#优先队列" class="headerlink" title="优先队列"></a>优先队列</h3><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240524182115097.png" alt="image-20240524182115097"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240524182127911.png" alt="image-20240524182127911"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240524182141588.png" alt="image-20240524182141588"></p>
<h4 id="模板题——小蓝的神奇复印机"><a href="#模板题——小蓝的神奇复印机" class="headerlink" title="模板题——小蓝的神奇复印机"></a>模板题——<a target="_blank" rel="noopener" href="https://www.lanqiao.cn/problems/3749/learning">小蓝的神奇复印机</a></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> queue <span class="hljs-keyword">import</span> PriorityQueue,Queue<br>N,X=<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>,<span class="hljs-built_in">input</span>().split())<br>a=<span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>,<span class="hljs-built_in">input</span>().split()))<br>q=Queue()<br>pq=PriorityQueue()<br><span class="hljs-keyword">for</span> i,x <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(a):<br>  q.put((i,x))<br>  pq.put(-x)<br>time=<span class="hljs-number">0</span><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>  i,x=q.get()<br>  <span class="hljs-keyword">if</span> -x==pq.queue[<span class="hljs-number">0</span>]:<br>    pq.get()<br>    time+=<span class="hljs-number">1</span><br>    <span class="hljs-keyword">if</span> i==X:<br>      <span class="hljs-built_in">print</span>(time)<br>      <span class="hljs-keyword">break</span><br>  <span class="hljs-keyword">else</span>:<br>    q.put((i,x))<br></code></pre></td></tr></table></figure>
<h2 id="ST表"><a href="#ST表" class="headerlink" title="ST表"></a>ST表</h2><h5 id="RMQ问题"><a href="#RMQ问题" class="headerlink" title="RMQ问题"></a>RMQ问题</h5><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240524183506581.png" alt="image-20240524183506581"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240524183726055.png" alt="image-20240524183726055"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240524183742068.png" alt="image-20240524183742068"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240524183753258.png" alt="image-20240524183753258"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240524183803151.png" alt="image-20240524183803151"></p>
<h2 id="并查集"><a href="#并查集" class="headerlink" title="并查集"></a>并查集</h2><h3 id="基础并查集"><a href="#基础并查集" class="headerlink" title="基础并查集"></a>基础并查集</h3><h4 id="基础-1"><a href="#基础-1" class="headerlink" title="基础"></a>基础</h4><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240524194242229.png" alt="image-20240524194242229"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240524194253527.png" alt="image-20240524194253527"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240524194301781.png" alt="image-20240524194301781"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240524194309669.png" alt="image-20240524194309669"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240524194317881.png" alt="image-20240524194317881"></p>
<h5 id="模板题——蓝桥幼儿园"><a href="#模板题——蓝桥幼儿园" class="headerlink" title="模板题——蓝桥幼儿园"></a>模板题——<a target="_blank" rel="noopener" href="https://www.lanqiao.cn/problems/1135/learning">蓝桥幼儿园</a></h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># def Findroot(x):</span><br><span class="hljs-comment">#     while x!=p[x]:</span><br><span class="hljs-comment">#         x=p[x]</span><br><span class="hljs-comment">#     return x</span><br><span class="hljs-string">&#x27;&#x27;&#x27;使用路径压缩&#x27;&#x27;&#x27;</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">Findroot</span>(<span class="hljs-params">x</span>):<br>    <span class="hljs-keyword">if</span> x==p[x]:<span class="hljs-keyword">return</span> x<br>    <span class="hljs-comment">#路径压缩</span><br>    p[x]=Findroot(p[x])<br>    <span class="hljs-keyword">return</span> p[x]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">Merge</span>(<span class="hljs-params">x,y</span>):<br>    rootx,rooty=Findroot(x),Findroot(y)<br>    p[rootx]=rooty<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">Query</span>(<span class="hljs-params">x,y</span>):<br>    rootx,rooty=Findroot(x),Findroot(y)<br>    <span class="hljs-keyword">return</span> rootx==rooty<br>n,m=<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>,<span class="hljs-built_in">input</span>().split())<br>p=<span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(n+<span class="hljs-number">1</span>))<br><span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m):<br>    op,x,y=<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>,<span class="hljs-built_in">input</span>().split())<br>    <span class="hljs-keyword">if</span> op ==<span class="hljs-number">1</span>:<br>        Merge(x,y)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">if</span> Query(x,y):<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;YES&quot;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;NO&quot;</span>)<br></code></pre></td></tr></table></figure>
<h4 id="路径压缩"><a href="#路径压缩" class="headerlink" title="路径压缩"></a>路径压缩</h4><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240524195007281.png" alt="image-20240524195007281"></p>
<h5 id="模板题——星球大战"><a href="#模板题——星球大战" class="headerlink" title="模板题——星球大战"></a>模板题——<a target="_blank" rel="noopener" href="https://www.lanqiao.cn/problems/828/learning/">星球大战</a></h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> sys<br>M = <span class="hljs-number">200010</span>; N = <span class="hljs-number">2</span> * M<br>n, m = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>father = [<span class="hljs-number">0</span>] * (n + <span class="hljs-number">10</span>)                 <span class="hljs-comment">#并查集板块</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">init</span>():<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n + <span class="hljs-number">10</span>):<br>        father[i] = i<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">find_father</span>(<span class="hljs-params">x</span>):<br>    <span class="hljs-keyword">if</span> x != father[x]: father[x] = find_father(father[x])<br>    <span class="hljs-keyword">return</span> father[x]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">unite</span>(<span class="hljs-params">x, y</span>):<br>    father[find_father(x)] = find_father(y)<br>come = [<span class="hljs-number">0</span>] * N; to = [<span class="hljs-number">0</span>] * N;   <span class="hljs-comment">#存储每个边</span><br>g = [[] <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(N)]      <span class="hljs-comment">#邻接表</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m):<br>    a, b = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>    g[a].append(b); g[b].append(a)<br>    come[i] = a; to[i] = b <br>broken = [<span class="hljs-number">0</span>] * (n + <span class="hljs-number">10</span>)                     <span class="hljs-comment">#记录每个点是否被修坏</span><br>destroy = []<br>k = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>())<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(k):<br>    b = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>())<br>    broken[b] = <span class="hljs-number">1</span><br>    destroy.append(b)<br>init()<br>res = n - k             <span class="hljs-comment">#先计算所有剩下星球的连通块数，(最后一轮的结果)</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m):<br>    l = come[i]; r = to[i]<br>    fl, fr = find_father(l), find_father(r)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> broken[l] <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> broken[r] <span class="hljs-keyword">and</span> fl != fr:<br>        res -= <span class="hljs-number">1</span><br>        <span class="hljs-comment">#unite(l, r)</span><br>        father[fl] = fr<br>ans = [res]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(destroy) - <span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>):       <span class="hljs-comment">#顺序破坏，相当于倒序修建</span><br>    c = destroy[i]<br>    broken[c] = <span class="hljs-number">0</span><br>    res += <span class="hljs-number">1</span>                                    <span class="hljs-comment">#修好一个星球，连通块会多一个</span><br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> g[c]:<br>        fc, fp = find_father(c), find_father(j)<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> broken[j] <span class="hljs-keyword">and</span> fc != fp:<br>            res -= <span class="hljs-number">1</span><br>            father[fc] = fp<br>    ans.append(res)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(ans) - <span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>):           <span class="hljs-comment">#倒序输出结果</span><br>    <span class="hljs-built_in">print</span>(ans[i])<br></code></pre></td></tr></table></figure>
<h3 id="可撤销并查集"><a href="#可撤销并查集" class="headerlink" title="可撤销并查集"></a>可撤销并查集</h3><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240524203431727.png" alt="image-20240524203431727"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240524203449967.png" alt="image-20240524203449967"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240524203621861.png" alt="image-20240524203621861"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240524203634004.png" alt="image-20240524203634004"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240524203643547.png" alt="image-20240524203643547"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240524203712193.png" alt="image-20240524203712193"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240524203728659.png" alt="image-20240524203728659"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240524203741431.png" alt="image-20240524203741431"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240524203752845.png" alt="image-20240524203752845"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240524203808480.png" alt="image-20240524203808480"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240524203837465.png" alt="image-20240524203837465"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240524203855506.png" alt="image-20240524203855506"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240524203906020.png" alt="image-20240524203906020"></p>
<h4 id="可撤销并查集定义"><a href="#可撤销并查集定义" class="headerlink" title="可撤销并查集定义"></a>可撤销并查集定义</h4><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240524203916807.png" alt="image-20240524203916807"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240524203959912.png" alt="image-20240524203959912"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240524204009818.png" alt="image-20240524204009818"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240524204018333.png" alt="image-20240524204018333"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240524204035190.png" alt="image-20240524204035190"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240524204043804.png" alt="image-20240524204043804"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240524204055615.png" alt="image-20240524204055615"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240524204106056.png" alt="image-20240524204106056"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240524204120154.png" alt="image-20240524204120154"></p>
<h4 id="算法原理"><a href="#算法原理" class="headerlink" title="算法原理"></a>算法原理</h4><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240524204147436.png" alt="image-20240524204147436"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240524204158246.png" alt="image-20240524204158246"></p>
<h3 id="带权并查集"><a href="#带权并查集" class="headerlink" title="带权并查集"></a>带权并查集</h3><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526102401075.png" alt="image-20240526102401075"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526102412755.png" alt="image-20240526102412755"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526102423880.png" alt="image-20240526102423880"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526102443080.png" alt="image-20240526102443080"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526102451528.png" alt="image-20240526102451528"></p>
<h2 id="树上问题"><a href="#树上问题" class="headerlink" title="树上问题"></a>树上问题</h2><h3 id="树的基本概念"><a href="#树的基本概念" class="headerlink" title="树的基本概念"></a>树的基本概念</h3><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526102633616.png" alt="image-20240526102633616"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526102641495.png" alt="image-20240526102641495"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526102651200.png" alt="image-20240526102651200"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526102714548.png" alt="image-20240526102714548"></p>
<h4 id="二叉树"><a href="#二叉树" class="headerlink" title="二叉树"></a>二叉树</h4><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526102917869.png" alt="image-20240526102917869"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526102815444.png" alt="image-20240526102815444"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526102945303.png" alt="image-20240526102945303"></p>
<h4 id="模板题——完全二叉树的权值"><a href="#模板题——完全二叉树的权值" class="headerlink" title="模板题——完全二叉树的权值"></a>模板题——<a target="_blank" rel="noopener" href="https://www.lanqiao.cn/problems/183/learning">完全二叉树的权值</a></h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> math<br><br>s = []<br>n = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>())<br>x = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split()))<br><br>deep = <span class="hljs-built_in">int</span>(math.log(n, <span class="hljs-number">2</span>)) + <span class="hljs-number">1</span>  <span class="hljs-comment"># 完全二叉树求深度公式</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(deep):  <span class="hljs-comment"># 按层数来遍历</span><br>    s.append(<span class="hljs-built_in">sum</span>(x[<span class="hljs-number">2</span> ** i - <span class="hljs-number">1</span>:<span class="hljs-number">2</span> ** i + <span class="hljs-number">2</span> ** i - <span class="hljs-number">1</span>]))  <span class="hljs-comment"># 切片出每层的节点，并计算其权值</span><br><span class="hljs-built_in">print</span>(s.index(<span class="hljs-built_in">max</span>(s)) + <span class="hljs-number">1</span>)  <span class="hljs-comment"># 找出权值最大的层级，并返回其索引</span><br></code></pre></td></tr></table></figure>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526103231454.png" alt="image-20240526103231454"></p>
<h3 id="树的遍历"><a href="#树的遍历" class="headerlink" title="树的遍历"></a>树的遍历</h3><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526103255622.png" alt="image-20240526103255622"></p>
<h4 id="先序遍历"><a href="#先序遍历" class="headerlink" title="先序遍历"></a>先序遍历</h4><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526103305459.png" alt="image-20240526103305459"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526103325159.png" alt="image-20240526103325159"></p>
<h4 id="中序遍历"><a href="#中序遍历" class="headerlink" title="中序遍历"></a>中序遍历</h4><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526103335871.png" alt="image-20240526103335871"></p>
<h4 id="后序遍历"><a href="#后序遍历" class="headerlink" title="后序遍历"></a>后序遍历</h4><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526103352924.png" alt="image-20240526103352924"></p>
<h4 id="层序遍历"><a href="#层序遍历" class="headerlink" title="层序遍历"></a>层序遍历</h4><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526103409405.png" alt="image-20240526103409405"></p>
<h4 id="树的遍历-1"><a href="#树的遍历-1" class="headerlink" title="树的遍历"></a>树的遍历</h4><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526103902993.png" alt="image-20240526103902993"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526103916051.png" alt="image-20240526103916051"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526103926976.png" alt="image-20240526103926976"></p>
<h4 id="模板题——欧涛爬树"><a href="#模板题——欧涛爬树" class="headerlink" title="模板题——欧涛爬树"></a>模板题——<a target="_blank" rel="noopener" href="https://www.lanqiao.cn/problems/3039/learning/">欧涛爬树</a></h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> sys<br>sys.setrecursionlimit(<span class="hljs-number">100000</span>)<br><span class="hljs-built_in">input</span>=sys.stdin.readline<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">dfs</span>(<span class="hljs-params">u,fa</span>):<span class="hljs-comment">#进行判断是否是叶子节点</span><br>    path.append(s[u])<br>    flag=<span class="hljs-literal">True</span><br>    <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> G[u]:<br>        <span class="hljs-keyword">if</span> v==fa:<span class="hljs-keyword">continue</span><br>        dfs(v,u)<br>        flag=<span class="hljs-literal">False</span><br>    <span class="hljs-keyword">if</span> flag:<br>        S.add(<span class="hljs-string">&#x27;&#x27;</span>.join(path))<br>    path.pop()<br><br><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    <span class="hljs-keyword">try</span>:<br>        n=<span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>())<br>        <span class="hljs-comment">#邻接表进行存放树</span><br>        G=[[] <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n+<span class="hljs-number">1</span>)]<br>        s=<span class="hljs-string">&#x27; &#x27;</span>+<span class="hljs-built_in">input</span>()<br>        <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n-<span class="hljs-number">1</span>):<br>            u,v=<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>,<span class="hljs-built_in">input</span>().split())<br>            G[u].append(v)<br>            G[v].append(u)<br>        path=[]<br>        S=<span class="hljs-built_in">set</span>()<br>        dfs(<span class="hljs-number">1</span>,-<span class="hljs-number">1</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-built_in">len</span>(S))<br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-keyword">break</span><br></code></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">read</span>():<br>    <span class="hljs-keyword">import</span> sys<br>    <span class="hljs-keyword">return</span> sys.stdin.readline().strip()<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">dfs</span>(<span class="hljs-params">root, fa</span>):<br>    path.append(s[root])<br>    flag = <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">for</span> to <span class="hljs-keyword">in</span> vis[root]:<br>        <span class="hljs-keyword">if</span> to == fa:<br>            <span class="hljs-keyword">continue</span><br>        dfs(to, root)<br>        flag = <span class="hljs-literal">False</span><br>    <span class="hljs-keyword">if</span> flag:<br>        result.add(<span class="hljs-string">&quot;&quot;</span>.join(path))<br>    path.pop()<br><br><br><span class="hljs-comment"># 多次输入模板</span><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    <span class="hljs-keyword">try</span>:<br>        n = <span class="hljs-built_in">int</span>(read())<br>        s = read()<br>        vis = [[] <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n)]<br>        <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n - <span class="hljs-number">1</span>):<br>            u, v = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, read().split())<br>            u -= <span class="hljs-number">1</span><br>            v -= <span class="hljs-number">1</span><br>            vis[u].append(v)<br>            vis[v].append(u)<br>        result = <span class="hljs-built_in">set</span>()<br>        path = []<br>        dfs(<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-built_in">len</span>(result))<br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-keyword">break</span><br></code></pre></td></tr></table></figure>
<h3 id="树的直径与重心"><a href="#树的直径与重心" class="headerlink" title="树的直径与重心"></a>树的直径与重心</h3><h4 id="树的直径"><a href="#树的直径" class="headerlink" title="树的直径"></a>树的直径</h4><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526104404857.png" alt="image-20240526104404857"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526104428203.png" alt="image-20240526104428203"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526104454203.png" alt="image-20240526104454203"></p>
<h4 id="模板题——直径"><a href="#模板题——直径" class="headerlink" title="模板题——直径"></a>模板题——<a target="_blank" rel="noopener" href="https://www.lanqiao.cn/problems/1394/learning">直径</a></h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> sys<br><br><span class="hljs-built_in">input</span> = sys.stdin.readline<br>sys.setrecursionlimit(<span class="hljs-number">100000</span>)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">dfs</span>(<span class="hljs-params">u, fa, pre=<span class="hljs-literal">None</span></span>):<br>    <span class="hljs-keyword">global</span> S<br>    <span class="hljs-keyword">if</span> d[u] &gt; d[S]: S = u<br>    <span class="hljs-keyword">for</span> v, w <span class="hljs-keyword">in</span> G[u]:<br>        <span class="hljs-keyword">if</span> v == fa: <span class="hljs-keyword">continue</span><br>        d[v] = d[u] + w<br>        <span class="hljs-keyword">if</span> pre: pre[v] = u<br>        dfs(v, u, pre)<br>n = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>())<br>G = [[] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n + <span class="hljs-number">1</span>)]<br>d = [<span class="hljs-number">0</span>] * (n + <span class="hljs-number">1</span>)<br>pre = [<span class="hljs-number">0</span>] * (n + <span class="hljs-number">1</span>)<br><span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n - <span class="hljs-number">1</span>):<br>    u, v, w = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>    G[u].append([v, w])<br>    G[v].append([u, w])<br>S = <span class="hljs-number">1</span><br>dfs(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>)<br>d[S] = <span class="hljs-number">0</span><br>dfs(S, <span class="hljs-number">0</span>, pre)<br>L = [S]<br>L_list = <span class="hljs-built_in">set</span>()<br><span class="hljs-keyword">while</span> S != <span class="hljs-number">0</span>:<br>    L_list.add(S)<br>    S = pre[S]<br><span class="hljs-keyword">for</span> u <span class="hljs-keyword">in</span> L_list:<br>    <span class="hljs-keyword">for</span> i, (v, w) <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(G[u]):<br>        <span class="hljs-keyword">if</span> v <span class="hljs-keyword">in</span> L_list:<br>            G[u][i] = [v, w - <span class="hljs-number">1</span>]<br>S = <span class="hljs-number">1</span><br>dfs(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>)<br>d[S] = <span class="hljs-number">0</span><br>dfs(S, <span class="hljs-number">0</span>)<br>L2 = d[S]<br><span class="hljs-built_in">print</span>(L)<br><span class="hljs-built_in">print</span>(L - L2)<br></code></pre></td></tr></table></figure>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526105912364.png" alt="image-20240526105912364"></p>
<h3 id="LCA"><a href="#LCA" class="headerlink" title="LCA"></a>LCA</h3><h4 id="最近公共祖先"><a href="#最近公共祖先" class="headerlink" title="最近公共祖先"></a>最近公共祖先</h4><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526105959804.png" alt="image-20240526105959804"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526110010233.png" alt="image-20240526110010233"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526110018355.png" alt="image-20240526110018355"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526110031858.png" alt="image-20240526110031858"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526110040710.png" alt="image-20240526110040710"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526110052606.png" alt="image-20240526110052606"></p>
<h4 id="模板题——最近公共祖先LCA查询"><a href="#模板题——最近公共祖先LCA查询" class="headerlink" title="模板题——最近公共祖先LCA查询"></a>模板题——<a target="_blank" rel="noopener" href="https://www.lanqiao.cn/problems/4385/learning">最近公共祖先LCA查询</a></h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> sys<br><br><span class="hljs-comment">#设置deep数组表示深度。</span><br><span class="hljs-comment">#front数组，表示节点u,前2**i层的爹是谁？？？</span><br>n=<span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>())<br>tree=[[] <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n+<span class="hljs-number">1</span>)]<br>fornt=[[<span class="hljs-number">0</span>]*(<span class="hljs-number">21</span>) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n+<span class="hljs-number">1</span>)]<span class="hljs-comment">#如果你是0你就是孤儿。</span><br>deep=[<span class="hljs-number">0</span>]*(n+<span class="hljs-number">1</span>)<span class="hljs-comment">#0节点没有层数。</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n-<span class="hljs-number">1</span>):<br>  u,v=<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>,<span class="hljs-built_in">input</span>().split())<br>  tree[u].append(v)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">dfs</span>(<span class="hljs-params">er,die</span>):<br>  <span class="hljs-keyword">if</span> die==<span class="hljs-number">0</span>:<br>    deep[er]=<span class="hljs-number">1</span><span class="hljs-comment">#这是第一层,同时，第一层也没有爹啊，也不需要更新如何层数相关节点。</span><br><br>  <span class="hljs-keyword">else</span>:<br>    deep[er]=deep[die]+<span class="hljs-number">1</span><span class="hljs-comment">#更新层数。</span><br>    fornt[er][<span class="hljs-number">0</span>]=die<span class="hljs-comment">#上一层的点，就是die。</span><br>    <span class="hljs-keyword">for</span> cc <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">21</span>):<br>      <span class="hljs-keyword">if</span> fornt[fornt[er][cc-<span class="hljs-number">1</span>]][cc-<span class="hljs-number">1</span>]!=<span class="hljs-number">0</span>:<br><br>        fornt[er][cc]=fornt[fornt[er][cc-<span class="hljs-number">1</span>]][cc-<span class="hljs-number">1</span>]<br>        <span class="hljs-comment">#倍增法。2**i层之上的点=</span><br>        <span class="hljs-comment">#2**(cc-1)上面的点的上面2**(cc-1)的点。就，无限套娃。</span><br>  <br>  <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> tree[er]:<br>    dfs(i,er)<span class="hljs-comment">#儿子变成新的爹。</span><br>dfs(<span class="hljs-number">1</span>,<span class="hljs-number">0</span>)<span class="hljs-comment">#儿子是根，爹不存在。</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">find</span>(<span class="hljs-params">x,y</span>):<br>  <span class="hljs-comment">#第一步，拉升。将x拉到和y一个水平。一开始走2**20步，太大，就走2**19步，然后走一半，再走一半</span><br>  <span class="hljs-comment">#就像那个乌龟与跑步哥一样。二进制原理使得这个步数遍历后一定是一个高度。</span><br>  <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">20</span>,-<span class="hljs-number">1</span>,-<span class="hljs-number">1</span>):<br>    <span class="hljs-keyword">if</span> deep[fornt[x][i]]&gt;=deep[y] <span class="hljs-keyword">and</span> fornt[x][i]!=<span class="hljs-number">0</span>:<br>      x=fornt[x][i]<span class="hljs-comment">#自动判断能走不能走，能走则走一大步。x提升到别的节点。</span><br><br>  <span class="hljs-comment">#此时提升必定一样了。</span><br>  <span class="hljs-keyword">if</span> x==y:<br>    <span class="hljs-keyword">return</span> x<span class="hljs-comment">#原来你就是我爹！</span><br>  <br>  <span class="hljs-keyword">else</span>:<span class="hljs-comment">#不是？我们再度提升吧！神明！</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">20</span>,-<span class="hljs-number">1</span>,-<span class="hljs-number">1</span>):<br>      <span class="hljs-keyword">if</span> fornt[x][i]!=fornt[y][i] <span class="hljs-keyword">and</span> fornt[x][i]!=<span class="hljs-number">0</span> <span class="hljs-keyword">and</span> fornt[y][i]!=<span class="hljs-number">0</span>:<span class="hljs-comment">#相等反而不能决定什么，因为可能不是最近的公共祖先</span><br>        x=fornt[x][i]<br>        y=fornt[y][i]<br>    <span class="hljs-keyword">return</span> fornt[y][<span class="hljs-number">0</span>]<span class="hljs-comment">#最后，y上面的就是自己的公共祖先。</span><br>q=<span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>())<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(q):<br>  x,y=<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>,<span class="hljs-built_in">input</span>().split())<br>  <span class="hljs-keyword">if</span> deep[x]&lt;deep[y]:<span class="hljs-comment">#我们设x是深节点。</span><br>    x,y=y,x<br>  <span class="hljs-built_in">print</span>(find(x,y))<br></code></pre></td></tr></table></figure>
<h3 id="树上差分"><a href="#树上差分" class="headerlink" title="树上差分"></a>树上差分</h3><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526110829760.png" alt="image-20240526110829760"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526110840432.png" alt="image-20240526110840432"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526110850262.png" alt="image-20240526110850262"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526110859590.png" alt="image-20240526110859590"></p>
<h4 id="问题引入"><a href="#问题引入" class="headerlink" title="问题引入"></a>问题引入</h4><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526110924343.png" alt="image-20240526110924343"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526110933963.png" alt="image-20240526110933963"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526110943437.png" alt="image-20240526110943437"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526110952759.png" alt="image-20240526110952759"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526111012615.png" alt="image-20240526111012615"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526111135950.png" alt="image-20240526111135950"></p>
<h4 id="模板题——"><a href="#模板题——" class="headerlink" title="模板题——"></a>模板题——</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> math<br><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> defaultdict<br><br>maxn = <span class="hljs-number">110000</span><br>n, k = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, sys.stdin.readline().split())<br>maxx = <span class="hljs-built_in">int</span>(math.log2(n))<br>edge = defaultdict(<span class="hljs-built_in">list</span>)<br>head = [<span class="hljs-number">0</span>] * (n + <span class="hljs-number">1</span>)<br>dep = [<span class="hljs-number">0</span>] * (n + <span class="hljs-number">1</span>)<br>dlt = [<span class="hljs-number">0</span>] * (n + <span class="hljs-number">1</span>)<br>fa = [[<span class="hljs-number">0</span>] * <span class="hljs-number">20</span> <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n + <span class="hljs-number">1</span>)]<br>cnt = <span class="hljs-number">0</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add_edge</span>(<span class="hljs-params">a, b, dis</span>):<br>    <span class="hljs-keyword">global</span> cnt<br>    cnt += <span class="hljs-number">1</span><br>    edge[cnt] = [head[a], b, dis]<br>    head[a] = cnt<br>    cnt += <span class="hljs-number">1</span><br>    edge[cnt] = [head[b], a, dis]<br>    head[b] = cnt<br><br><span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n - <span class="hljs-number">1</span>):<br>    a, b, dis = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, sys.stdin.readline().split())<br>    add_edge(a, b, dis)<br><br>dfs(<span class="hljs-number">1</span>)<br><br><span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(k):<br>    a, b, x = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, sys.stdin.readline().split())<br>    dlt[a] += x<br>    dlt[b] += x<br>    c = lca(a, b)<br>    dlt[c] -= <span class="hljs-number">2</span> * x<br><br>dfs1(<span class="hljs-number">1</span>)<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):<br>    <span class="hljs-built_in">print</span>(dlt[i], end=<span class="hljs-string">&#x27; &#x27;</span>)<br><span class="hljs-built_in">print</span>()<br></code></pre></td></tr></table></figure>
<h3 id="DFS序"><a href="#DFS序" class="headerlink" title="DFS序"></a>DFS序</h3><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526111342883.png" alt="image-20240526111342883"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526111358571.png" alt="image-20240526111358571"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526111411449.png" alt="image-20240526111411449"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526111421595.png" alt="image-20240526111421595"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526111429485.png" alt="image-20240526111429485"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526111439242.png" alt="image-20240526111439242"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526111454557.png" alt="image-20240526111454557"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526111510842.png" alt="image-20240526111510842"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526111525573.png" alt="image-20240526111525573"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526111537764.png" alt="image-20240526111537764"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526111549957.png" alt="image-20240526111549957"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526111604828.png" alt="image-20240526111604828"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526111613985.png" alt="image-20240526111613985"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526111621233.png" alt="image-20240526111621233"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526111628644.png" alt="image-20240526111628644"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526111634702.png" alt="image-20240526111634702"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526111645145.png" alt="image-20240526111645145"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526111654060.png" alt="image-20240526111654060"></p>
<h4 id="模板题——异或和"><a href="#模板题——异或和" class="headerlink" title="模板题——异或和"></a>模板题——<a target="_blank" rel="noopener" href="https://www.lanqiao.cn/problems/3549/learning">异或和</a></h4><h5 id="dfs序和树状数组"><a href="#dfs序和树状数组" class="headerlink" title="dfs序和树状数组"></a>dfs序和树状数组</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs python">n, m = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>v = [<span class="hljs-number">0</span>] + <span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split()))<br>g = [[] <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n + <span class="hljs-number">1</span>)]<br><span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n - <span class="hljs-number">1</span>):<br>    u, va = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>    g[u].append(va)<br>    g[va].append(u)<br><br>tree = [<span class="hljs-number">0</span>] * (n + <span class="hljs-number">1</span>)<br>a = [[<span class="hljs-number">0</span>, <span class="hljs-number">0</span>] <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n + <span class="hljs-number">1</span>)] <span class="hljs-comment"># 存dfs序</span><br>cnt = <span class="hljs-number">0</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">dfs</span>(<span class="hljs-params">node, fa</span>):<br>    <span class="hljs-keyword">global</span> cnt<br>    cnt += <span class="hljs-number">1</span><br>    a[node][<span class="hljs-number">0</span>] = cnt<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> g[node]:<br>        <span class="hljs-keyword">if</span> i != fa:<br>            dfs(i, node)<br>    a[node][<span class="hljs-number">1</span>] = cnt<br>dfs(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">lowbit</span>(<span class="hljs-params">x</span>):<br>    <span class="hljs-keyword">return</span> x &amp; (-x)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">update</span>(<span class="hljs-params">x, d</span>):<br>    <span class="hljs-keyword">while</span> x &lt;= n:<br>        tree[x] ^= d<br>        x += lowbit(x)<br>        <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">query</span>(<span class="hljs-params">x</span>):<br>    ans = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> x:<br>        ans ^= tree[x]<br>        x -= lowbit(x)<br>    <span class="hljs-keyword">return</span> ans<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):<br>    update(a[i][<span class="hljs-number">0</span>], v[i])<br><br><span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m):<br>    o = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split()))<br>    <span class="hljs-keyword">if</span> o[<span class="hljs-number">0</span>] == <span class="hljs-number">2</span>:<br>        <span class="hljs-built_in">print</span>(query(a[o[<span class="hljs-number">1</span>]][<span class="hljs-number">1</span>]) ^ query(a[o[<span class="hljs-number">1</span>]][<span class="hljs-number">0</span>] - <span class="hljs-number">1</span>))<br>    <span class="hljs-keyword">else</span>:<br>        x, y = o[<span class="hljs-number">1</span>], o[<span class="hljs-number">2</span>]<br>        update(a[x][<span class="hljs-number">0</span>], v[x] ^ y)<br>        v[x] = y<br></code></pre></td></tr></table></figure>
<h5 id="模拟暴力代码"><a href="#模拟暴力代码" class="headerlink" title="模拟暴力代码"></a>模拟暴力代码</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs python">n, m = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>a = [<span class="hljs-number">0</span>] + <span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split()))<br>g = [[] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n + <span class="hljs-number">1</span>)]<br><span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n - <span class="hljs-number">1</span>):<br>    c, d =<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>    g[c].append(d)<br>    g[d].append(c)<br><br>dep = [<span class="hljs-number">0</span>] * (n + <span class="hljs-number">1</span>)<br>dep[<span class="hljs-number">1</span>] = <span class="hljs-number">1</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">depth</span>(<span class="hljs-params">node, fa</span>):<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> g[node]:<br>        <span class="hljs-keyword">if</span> i != fa:<br>            dep[i] = dep[node] + <span class="hljs-number">1</span><br>            depth(i, node)<br>depth(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">dfs</span>(<span class="hljs-params">node</span>):<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> g[node]:<br>        <span class="hljs-keyword">if</span> dep[i] &gt; dep[node]:<br>            li.append(a[i])<br>            dfs(i)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">query</span>(<span class="hljs-params">n</span>):<br>    <span class="hljs-keyword">global</span> li<br>    li = [a[n]]<br>    dfs(n)<br>    ans = li[<span class="hljs-number">0</span>]<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-built_in">len</span>(li)):<br>        ans = ans ^ li[i]<br>    <span class="hljs-built_in">print</span>(ans)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">change</span>(<span class="hljs-params">x, y</span>):<br>    a[x] = y<br><br><span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m):<br>    o = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split()))<br>    <span class="hljs-keyword">if</span> o[<span class="hljs-number">0</span>] == <span class="hljs-number">2</span>: query(o[<span class="hljs-number">1</span>])<br>    <span class="hljs-keyword">else</span>: change(o[<span class="hljs-number">1</span>], o[<span class="hljs-number">2</span>])<br></code></pre></td></tr></table></figure>
<p>利用邻接表打印树结构，然后根据子树根节点寻找打印子树的元素，存到列表中，最后对列表的所有元素（即子树的所有点）进行异或和运算</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> sys<br><br>n, m = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())  <span class="hljs-comment"># 读取输入的 n 和 m</span><br>value = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split()))  <span class="hljs-comment"># 读取输入的值列表</span><br>value.insert(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>)  <span class="hljs-comment"># 在值列表的最前面插入 0,根节点为1，索引从1开始</span><br>yihuo = []  <span class="hljs-comment"># 存储异或运算结果的列表</span><br>tree = [[] <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n + <span class="hljs-number">1</span>)]  <span class="hljs-comment"># 初始化邻接表,表示树结构</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n - <span class="hljs-number">1</span>):  <span class="hljs-comment"># 读取 n-1 次输入</span><br>    a, b = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>    a, b = <span class="hljs-built_in">min</span>(a, b), <span class="hljs-built_in">max</span>(a, b)<br>    tree[a].append(b)  <span class="hljs-comment"># 在 a 结点的邻接表中添加 b 结点，说明b为a的子节点</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m):  <span class="hljs-comment"># 读取 m 次操作输入</span><br>    op = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split()))<br>    <span class="hljs-keyword">if</span> op[<span class="hljs-number">0</span>] == <span class="hljs-number">1</span>:  <span class="hljs-comment"># 如果是操作 1</span><br>        value[op[<span class="hljs-number">1</span>]] = op[<span class="hljs-number">2</span>]  <span class="hljs-comment"># 更新点权</span><br>    <span class="hljs-keyword">else</span>:  <span class="hljs-comment"># 如果是操作 2</span><br>        x = op[<span class="hljs-number">1</span>]<span class="hljs-comment">#子树根节点</span><br>        vis = [x]  <span class="hljs-comment"># 把子树存到该列表里</span><br>        qfront = <span class="hljs-number">0</span>  <span class="hljs-comment"># 队列的头指针</span><br>        qend = <span class="hljs-number">1</span>  <span class="hljs-comment"># 队列的尾指针</span><br>        <span class="hljs-keyword">while</span> qfront != qend:  <span class="hljs-comment"># 当队列不为空时</span><br>            <span class="hljs-keyword">if</span> tree[vis[qfront]] != []:  <span class="hljs-comment"># 该节点有子节点</span><br>                vis.extend(tree[vis[qfront]])  <span class="hljs-comment"># 将子节点存到子树中</span><br>                qend += <span class="hljs-built_in">len</span>(tree[vis[qfront]])  <span class="hljs-comment"># 更新队列的尾指针</span><br>            qfront += <span class="hljs-number">1</span>  <span class="hljs-comment"># 更新队列的头指针</span><br>        ans = value[vis[<span class="hljs-number">0</span>]]  <span class="hljs-comment"># 初始化异或运算的结果</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-built_in">len</span>(vis)):  <span class="hljs-comment"># 遍历访问列表中的结点</span><br>            ans ^= value[vis[i]]  <span class="hljs-comment"># 对每个结点的值进行异或运算</span><br>        yihuo.append(ans)  <span class="hljs-comment"># 将异或运算的结果加入到结果列表中</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> yihuo:  <span class="hljs-comment"># 遍历结果列表</span><br>    <span class="hljs-built_in">print</span>(i)  <span class="hljs-comment"># 输出每个异或运算的结果</span><br></code></pre></td></tr></table></figure>
<h3 id="树链剖分"><a href="#树链剖分" class="headerlink" title="树链剖分"></a>树链剖分</h3><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526112353706.png" alt="image-20240526112353706"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526112401255.png" alt="image-20240526112401255"></p>
<h4 id="重链部分"><a href="#重链部分" class="headerlink" title="重链部分"></a>重链部分</h4><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526112422998.png" alt="image-20240526112422998"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526112438353.png" alt="image-20240526112438353"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526112446340.png" alt="image-20240526112446340"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526112453669.png" alt="image-20240526112453669"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526112501407.png" alt="image-20240526112501407"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526112511133-1716693912043-1.png" alt="image-20240526112511133"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526112520973.png" alt="image-20240526112520973"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526112528251.png" alt="image-20240526112528251"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526112534620.png" alt="image-20240526112534620"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526112540265.png" alt="image-20240526112540265"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526112547668.png" alt="image-20240526112547668"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526112554018.png" alt="image-20240526112554018"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526112600918.png" alt="image-20240526112600918"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526112606842.png" alt="image-20240526112606842"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526112612323.png" alt="image-20240526112612323"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526112617087.png" alt="image-20240526112617087"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526112624067.png" alt="image-20240526112624067"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526112632456.png" alt="image-20240526112632456"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526112636784.png" alt="image-20240526112636784"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526112641641.png" alt="image-20240526112641641"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526112646496.png" alt="image-20240526112646496"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526112653107.png" alt="image-20240526112653107"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526112657735.png" alt="image-20240526112657735"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526112703078.png" alt="image-20240526112703078"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526112709755.png" alt="image-20240526112709755"></p>
<h4 id="树链部分的性质"><a href="#树链部分的性质" class="headerlink" title="树链部分的性质"></a>树链部分的性质</h4><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526112730804.png" alt="image-20240526112730804"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526112737253.png" alt="image-20240526112737253"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526112746989.png" alt="image-20240526112746989"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526112753152.png" alt="image-20240526112753152"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526112759297.png" alt="image-20240526112759297"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526112805144.png" alt="image-20240526112805144"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526112810692.png" alt="image-20240526112810692"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526112816453.png" alt="image-20240526112816453"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526112839302.png" alt="image-20240526112839302"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526112846421.png" alt="image-20240526112846421"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526112851218.png" alt="image-20240526112851218"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526112856579.png" alt="image-20240526112856579"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526112901873.png" alt="image-20240526112901873"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526112907428.png" alt="image-20240526112907428"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526112913595.png" alt="image-20240526112913595"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526112918708.png" alt="image-20240526112918708"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526112923449.png" alt="image-20240526112923449"></p>
<h2 id="树形数据结构"><a href="#树形数据结构" class="headerlink" title="树形数据结构"></a>树形数据结构</h2><h3 id="树状数组基础"><a href="#树状数组基础" class="headerlink" title="树状数组基础"></a>树状数组基础</h3><h4 id="lowbit操作"><a href="#lowbit操作" class="headerlink" title="lowbit操作"></a>lowbit操作</h4><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526113101030.png" alt="image-20240526113101030"></p>
<h4 id="树状数组"><a href="#树状数组" class="headerlink" title="树状数组"></a>树状数组</h4><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526113114986.png" alt="image-20240526113114986"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526113123838.png" alt="image-20240526113123838"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526113132131.png" alt="image-20240526113132131"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526113141135.png" alt="image-20240526113141135"></p>
<h4 id="模板题——单点修改，区间查询"><a href="#模板题——单点修改，区间查询" class="headerlink" title="模板题——单点修改，区间查询"></a>模板题——<a target="_blank" rel="noopener" href="https://www.lanqiao.cn/problems/2340/learning/">单点修改，区间查询</a></h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs py">N = <span class="hljs-number">100100</span><br><span class="hljs-comment">#初始化树状数组 为0</span><br>f = [<span class="hljs-number">0</span>] * N<br><br><span class="hljs-comment">#求下标为x的最小区间长度</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">lowbit</span>(<span class="hljs-params">x</span>):<br>    <span class="hljs-keyword">return</span> x &amp; (-x)<br><br><span class="hljs-comment">#树状数组更新函数</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">upd</span>(<span class="hljs-params">pos,v</span>):<span class="hljs-comment">#pos：下标 v：值</span><br>    <span class="hljs-comment">#在下标为pos的区间加上v 并且在每个有包含pos的大区间加上v</span><br>    <span class="hljs-comment">#包含当前区间的大区间：在pos的位置上加lowbit(pos)便能得到大区间</span><br>    <span class="hljs-keyword">while</span> pos &lt;= n:<br>        f[pos] += v<br>        pos += lowbit(pos)<br><br><span class="hljs-comment">#得到1-pos位置的前缀和</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get</span>(<span class="hljs-params">pos</span>):<br>    res = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> pos &gt; <span class="hljs-number">0</span>:<span class="hljs-comment">#加上组成pos每一个区间的和</span><br>        res += f[pos]<br>        pos -= lowbit(pos)<br>    <span class="hljs-keyword">return</span> res<br><br>n = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>())<br>data = <span class="hljs-built_in">input</span>().split()<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,n):<br>    x = <span class="hljs-built_in">int</span>(data[i])<br>    <span class="hljs-comment">#树状数组初始化都为0，需要将原数组每个值通过upd方法将每个值加入树状数组</span><br>    upd(i+<span class="hljs-number">1</span>,x)<br><br>m = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>())<br><span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m):<br>    opt,a,b = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>,<span class="hljs-built_in">input</span>().split())<br>    <span class="hljs-keyword">if</span> opt == <span class="hljs-number">1</span>:<br>        upd(a,b)<span class="hljs-comment">#更新</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-comment">#区间[a,b] = [1,b] - [1,a-1]</span><br>        <span class="hljs-built_in">print</span>(get(b) - get(a-<span class="hljs-number">1</span>))<br></code></pre></td></tr></table></figure>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> sys<br>N = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>())<br>n = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>,<span class="hljs-built_in">input</span>().split()))<br>m = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>())<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m):<br>  s,a,b = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>,<span class="hljs-built_in">input</span>().split())<br>  <span class="hljs-keyword">if</span> s == <span class="hljs-number">1</span>:<br>    n[a-<span class="hljs-number">1</span>] += b<br>  <span class="hljs-keyword">if</span> s == <span class="hljs-number">2</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">sum</span>(n[a-<span class="hljs-number">1</span>:b]))<br></code></pre></td></tr></table></figure>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526113358856.png" alt="image-20240526113358856"></p>
<h4 id="树状数组-1"><a href="#树状数组-1" class="headerlink" title="树状数组"></a>树状数组</h4><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526113430755.png" alt="image-20240526113430755"></p>
<h4 id="模板题——殷老师排队"><a href="#模板题——殷老师排队" class="headerlink" title="模板题——殷老师排队"></a>模板题——<a target="_blank" rel="noopener" href="https://www.lanqiao.cn/problems/3620/learning/">殷老师排队</a></h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> sys<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">lowbit</span>(<span class="hljs-params">x</span>):<br>  <span class="hljs-keyword">return</span> x &amp; (-x)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">query</span>(<span class="hljs-params">x</span>):<br>  ans = <span class="hljs-number">0</span><br>  <span class="hljs-keyword">while</span> x:<br>    ans += tree[x]<br>    x -= lowbit(x)<br>  <span class="hljs-keyword">return</span> ans <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">x,y</span>):<br>  <span class="hljs-keyword">while</span> x &lt;= n:<br>    tree[x] += y<br>    x += lowbit(x)<br><br>n, m = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>,<span class="hljs-built_in">input</span>().split())<br>a =[<span class="hljs-number">0</span>] + <span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>,<span class="hljs-built_in">input</span>().split()))<br>tree = [<span class="hljs-number">0</span>] * (n + <span class="hljs-number">1</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,n+<span class="hljs-number">1</span>):<br>  add(i,a[i])<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m):<br>  lt = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>,<span class="hljs-built_in">input</span>().split()))<br>  <span class="hljs-keyword">if</span> lt[<span class="hljs-number">0</span>] == <span class="hljs-number">1</span>:<br>    x, y = lt[<span class="hljs-number">1</span>], lt[<span class="hljs-number">2</span>]<br>    add(x,y - a[x])<br>    a[x] = y<br>  <span class="hljs-keyword">else</span>:<br>    x = lt[<span class="hljs-number">1</span>]<br>    ans = (<span class="hljs-number">2</span> * x - n - <span class="hljs-number">2</span>) * a[x] + query(n) - <span class="hljs-number">2</span>*query(x-<span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(ans)<br></code></pre></td></tr></table></figure>
<h3 id="二维树状数组"><a href="#二维树状数组" class="headerlink" title="二维树状数组"></a>二维树状数组</h3><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526113722203.png" alt="image-20240526113722203"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526113730769.png" alt="image-20240526113730769"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526113742110.png" alt="image-20240526113742110"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526113748208.png" alt="image-20240526113748208"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526113754750.png" alt="image-20240526113754750"></p>
<h4 id="模板题——-1"><a href="#模板题——-1" class="headerlink" title="模板题——"></a>模板题——</h4><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526113904670.png" alt="image-20240526113904670"></p>
<h3 id="树状数组上二分"><a href="#树状数组上二分" class="headerlink" title="树状数组上二分"></a>树状数组上二分</h3><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526113950824.png" alt="image-20240526113950824"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526113958446.png" alt="image-20240526113958446"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526114007562.png" alt="image-20240526114007562"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526114020291.png" alt="image-20240526114020291"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526114102890.png" alt="image-20240526114102890"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526114113384.png" alt="image-20240526114113384"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526114124229.png" alt="image-20240526114124229"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526114131782.png" alt="image-20240526114131782"></p>
<h4 id="模板题——-2"><a href="#模板题——-2" class="headerlink" title="模板题——"></a>模板题——</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs python">maxn = <span class="hljs-number">110000</span><br>ans = [<span class="hljs-number">0</span>] * maxn<br>tree = [<span class="hljs-number">0</span>] * maxn<br>a = [<span class="hljs-number">0</span>] * maxn<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">lowbit</span>(<span class="hljs-params">x</span>):<br>    <span class="hljs-keyword">return</span> x &amp; -x<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">pos, x</span>):<br>    <span class="hljs-keyword">while</span> pos &lt; maxn:<br>        tree[pos] += x<br>        pos += lowbit(pos)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">query</span>(<span class="hljs-params">pos</span>):<br>    res = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> pos &gt; <span class="hljs-number">0</span>:<br>        res += tree[pos]<br>        pos -= lowbit(pos)<br>    <span class="hljs-keyword">return</span> res<br><br>n = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>())<br>nums = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().strip().split()))<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):<br>    a[i] = nums[i - <span class="hljs-number">1</span>]<br>    add(i, <span class="hljs-number">1</span>)<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>):<br>    l, r = <span class="hljs-number">1</span>, n<br>    <span class="hljs-keyword">while</span> l &lt;= r:<br>        mid = (l + r) // <span class="hljs-number">2</span><br>        <span class="hljs-keyword">if</span> query(mid) &lt; a[i] + <span class="hljs-number">1</span>:<br>            l = mid + <span class="hljs-number">1</span><br>        <span class="hljs-keyword">else</span>:<br>            r = mid - <span class="hljs-number">1</span><br>    ans[i] = r<br>    add(r, -<span class="hljs-number">1</span>)<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):<br>    <span class="hljs-built_in">print</span>(ans[i], end=<span class="hljs-string">&#x27; &#x27;</span>)<br></code></pre></td></tr></table></figure>
<h3 id="线段树-动态开点"><a href="#线段树-动态开点" class="headerlink" title="线段树-动态开点"></a>线段树-动态开点</h3><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526121216936.png" alt="image-20240526121216936"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526121240169.png" alt="image-20240526121240169"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526121250475.png" alt="image-20240526121250475"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526121357462.png" alt="image-20240526121357462"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526121408234.png" alt="image-20240526121408234"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526121446955.png" alt="image-20240526121446955"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526121517887.png" alt="image-20240526121517887"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526121505465.png" alt="image-20240526121505465"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526121533131.png" alt="image-20240526121533131"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526121542078.png" alt="image-20240526121542078"></p>
<h4 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h4><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526121653108.png" alt="image-20240526121653108"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Tree</span> &#123;</span><br>    <span class="hljs-type">int</span> l, r, n, ls, rs;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">(<span class="hljs-type">int</span> &amp;t, <span class="hljs-type">int</span> l, <span class="hljs-type">int</span> r, <span class="hljs-type">int</span> pos, <span class="hljs-type">int</span> n)</span> &#123;<br>    <span class="hljs-keyword">if</span> (!t) &#123;<br>        t = ++ cnt;<br>        tree[t].l = l;<br>        tree[t].r = r;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (l == r) &#123;<br>        tree[t].n = n;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-type">int</span> mid = (l + r) &gt;&gt; <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">if</span> (pos &lt;= mid) &#123;<br>        update(tree[t].ls, l, mid, pos, n);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        update(tree[t].rs, mid + <span class="hljs-number">1</span>, r, pos, n);<br>    &#125;<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">getnum</span><span class="hljs-params">(<span class="hljs-type">int</span> t, <span class="hljs-type">int</span> l, <span class="hljs-type">int</span> r)</span> &#123;<br>    <span class="hljs-keyword">if</span> (!t) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (tree[t].l == l &amp;&amp; tree[t].r == r) &#123;<br>        <span class="hljs-keyword">return</span> tree[t].n;<br>    &#125;<br>    <span class="hljs-type">int</span> mid = (tree[t].l + tree[t].r) &gt;&gt; <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">if</span> (r &lt;= mid) &#123;<br>        <span class="hljs-keyword">return</span> getnum(tree[t].ls, l, r);<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (l &gt; mid) &#123;<br>        <span class="hljs-keyword">return</span> getnum(tree[t].rs, l, r);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> getnum(tree[t].ls, l, mid) + getnum(tree[t].rs, mid + <span class="hljs-number">1</span>, r);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="线段树-标记永久化"><a href="#线段树-标记永久化" class="headerlink" title="线段树-标记永久化"></a>线段树-标记永久化</h3><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526121717724.png" alt="image-20240526121717724"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526121729855.png" alt="image-20240526121729855"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526121746997.png" alt="image-20240526121746997"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526121821681.png" alt="image-20240526121821681"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526121831175.png" alt="image-20240526121831175"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526121847400.png" alt="image-20240526121847400"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526121855524.png" alt="image-20240526121855524"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526121904894.png" alt="image-20240526121904894"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526121912575.png" alt="image-20240526121912575"></p>
<h4 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">build</span><span class="hljs-params">(<span class="hljs-type">int</span> t, <span class="hljs-type">int</span> l, <span class="hljs-type">int</span> r, <span class="hljs-type">int</span> *v)</span> &#123;<br>    _l[t] = l;<br>    _r[t] = r;<br>    <span class="hljs-keyword">if</span> (l == r) &#123;<br>        _v[t] = v[l];<br>        <span class="hljs-keyword">return</span> ;<br>    &#125;<br>    <span class="hljs-type">int</span> mid = (l + r) &gt;&gt; <span class="hljs-number">1</span>;<br>    build(t &lt;&lt; <span class="hljs-number">1</span>, l, mid, v);<br>    build(t &lt;&lt; <span class="hljs-number">1</span> | <span class="hljs-number">1</span>, mid + <span class="hljs-number">1</span>, r, v);<br>    _v[t] = _v[t &lt;&lt; <span class="hljs-number">1</span>] + _v[t &lt;&lt; <span class="hljs-number">1</span> | <span class="hljs-number">1</span>];<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">(<span class="hljs-type">int</span> t, <span class="hljs-type">int</span> l, <span class="hljs-type">int</span> r, <span class="hljs-type">int</span> k)</span> &#123;<br>    _v[t] += k * (r - l + <span class="hljs-number">1</span>);<br>    <span class="hljs-keyword">if</span> (_l[t] == l &amp;&amp; _r[t] == r) &#123;<br>        _laz[t] += k;<br>        <span class="hljs-keyword">return</span> ;<br>    &#125;<br>    <span class="hljs-type">int</span> mid = (_l[t] + _r[t]) &gt;&gt; <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">if</span> (r &lt;= mid) &#123;<br>        update(t &lt;&lt; <span class="hljs-number">1</span>, l, r, k);<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (l &gt; mid) &#123;<br>        update(t &lt;&lt; <span class="hljs-number">1</span> | <span class="hljs-number">1</span>, l, r, k);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        update(t &lt;&lt; <span class="hljs-number">1</span>, l, mid, k);<br>        update(t &lt;&lt; <span class="hljs-number">1</span> | <span class="hljs-number">1</span>, mid + <span class="hljs-number">1</span>, r, k);<br>    &#125;<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">getv</span><span class="hljs-params">(<span class="hljs-type">int</span> t, <span class="hljs-type">int</span> l, <span class="hljs-type">int</span> r, <span class="hljs-type">int</span> sum)</span> &#123;<br>    <span class="hljs-keyword">if</span> (_l[t] == l &amp;&amp; _r[t] == r) &#123;<br>        <span class="hljs-keyword">return</span> _v[t] + sum * (_r[t] - _l[t] + <span class="hljs-number">1</span>);;<br>    &#125;<br>    <span class="hljs-type">int</span> mid = (_l[t] + _r[t]) &gt;&gt; <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">if</span> (r &lt;= mid) &#123;<br>        <span class="hljs-keyword">return</span> getv(t &lt;&lt; <span class="hljs-number">1</span>, l, r, sum + _laz[t]);<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (l &gt; mid) &#123;<br>        <span class="hljs-keyword">return</span> getv(t &lt;&lt; <span class="hljs-number">1</span> | <span class="hljs-number">1</span>, l, r, sum + _laz[t]);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> getv(t &lt;&lt; <span class="hljs-number">1</span>, l, mid, sum + _laz[t])<br>            + getv(t &lt;&lt; <span class="hljs-number">1</span> | <span class="hljs-number">1</span>, mid + <span class="hljs-number">1</span>, r, sum + _laz[t]);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="线段树维护矩阵"><a href="#线段树维护矩阵" class="headerlink" title="线段树维护矩阵"></a>线段树维护矩阵</h3><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526124453903.png" alt="image-20240526124453903"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526124459467.png" alt="image-20240526124459467"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526124505523.png" alt="image-20240526124505523"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526124509905.png" alt="image-20240526124509905"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526124524019.png" alt="image-20240526124524019"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526124529840.png" alt="image-20240526124529840"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526124537171.png" alt="image-20240526124537171"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526124545230.png" alt="image-20240526124545230"></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">build</span><span class="hljs-params">(<span class="hljs-type">int</span> t, <span class="hljs-type">int</span> l, <span class="hljs-type">int</span> r)</span> </span>&#123;<br>    _l[t] = l;<br>    _r[t] = r;<br>    _v[t] = _E;<br>    <span class="hljs-keyword">if</span> (l == r) &#123;<br>        <span class="hljs-keyword">return</span> ;<br>    &#125;<br>    <span class="hljs-type">int</span> mid = (l + r) &gt;&gt; <span class="hljs-number">1</span>;<br>    <span class="hljs-built_in">build</span>(t &lt;&lt; <span class="hljs-number">1</span>, l, mid);<br>    <span class="hljs-built_in">build</span>(t &lt;&lt; <span class="hljs-number">1</span> | <span class="hljs-number">1</span>, mid + <span class="hljs-number">1</span>, r);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">update</span><span class="hljs-params">(<span class="hljs-type">int</span> t, <span class="hljs-type">int</span> pos, MATRIX &amp;v)</span> </span>&#123;<br>    <span class="hljs-keyword">if</span> (_l[t] = _r[t]) &#123;<br>        _v[t] = v;<br>        <span class="hljs-keyword">return</span> ;<br>    &#125;<br>    <span class="hljs-type">int</span> mid = (_l[t] + _r[t]) &gt;&gt; <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">if</span> (pos &lt;= mid) &#123;<br>        <span class="hljs-built_in">update</span>(t &lt;&lt; <span class="hljs-number">1</span>, pos, v);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-built_in">update</span>(t &lt;&lt; <span class="hljs-number">1</span> | <span class="hljs-number">1</span>, pos, v);<br>    &#125;<br>    _v[t] = _v[t &lt;&lt; <span class="hljs-number">1</span>] * _v[t &lt;&lt; <span class="hljs-number">1</span> | <span class="hljs-number">1</span>];<br>&#125;<br><br><span class="hljs-function">MATRIX <span class="hljs-title">getv</span><span class="hljs-params">(<span class="hljs-type">int</span> t, <span class="hljs-type">int</span> l, <span class="hljs-type">int</span> r)</span> </span>&#123;<br>    <span class="hljs-keyword">if</span> (_l[t] == l &amp;&amp; _r[t] == r) &#123;<br>        <span class="hljs-keyword">return</span> _v[t];<br>    &#125;<br>    <span class="hljs-type">int</span> mid = (_l[t] + _r[t]) &gt;&gt; <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">if</span> (r &lt;= mid) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">getv</span>(t &lt;&lt; <span class="hljs-number">1</span>, l, r);<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (l &gt; mid) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">getv</span>(t &lt;&lt; <span class="hljs-number">1</span> | <span class="hljs-number">1</span>, l, r);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">getv</span>(t &lt;&lt; <span class="hljs-number">1</span>, l, mid) * <span class="hljs-built_in">getv</span>(t &lt;&lt; <span class="hljs-number">1</span> | <span class="hljs-number">1</span>, mid + <span class="hljs-number">1</span>, r);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="线段树维护哈希"><a href="#线段树维护哈希" class="headerlink" title="线段树维护哈希"></a>线段树维护哈希</h3><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526124653609.png" alt="image-20240526124653609"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526124700848.png" alt="image-20240526124700848"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526124710439.png" alt="image-20240526124710439"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526124717847.png" alt="image-20240526124717847"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526124726230.png" alt="image-20240526124726230"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526124754241.png" alt="image-20240526124754241"></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><code class="hljs py">bs1= []<br>bs2= []<br>mod1 = <span class="hljs-number">998244353</span><br>mod2 = <span class="hljs-number">19260817</span><br>bas = <span class="hljs-number">233</span><br>s = []<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">asdf</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, h1, h2, length</span>):<br>        self.h1 = h1<br>        self.h2 = h2<br>        self.length = length<br>    <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__add__</span>(<span class="hljs-params">self, c</span>):<br>        <span class="hljs-keyword">return</span> asdf((self.h1 * bs1[c.length] + c.h1) % mod1, (self.h2 * bs2[c.length] + c.h2) % mod2, self.length + c.length)<br>    <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__eq__</span>(<span class="hljs-params">self, c</span>):<br>        <span class="hljs-keyword">return</span> self.h1 == c.h1 <span class="hljs-keyword">and</span> self.h2 == c.h2 <span class="hljs-keyword">and</span> self.length == c.length<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">build</span>(<span class="hljs-params">l, r, rt</span>):<br>    <span class="hljs-keyword">if</span> l == r:<br>        s[rt] = asdf(<span class="hljs-built_in">ord</span>(a[l]), <span class="hljs-built_in">ord</span>(a[l]), <span class="hljs-number">1</span>)<br>        <span class="hljs-keyword">return</span> s[rt]<br>    s[rt] = build(l, (l + r) // <span class="hljs-number">2</span>, rt * <span class="hljs-number">2</span>) + build((l + r) // <span class="hljs-number">2</span> + <span class="hljs-number">1</span>, r, rt * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">return</span> s[rt]<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">query</span>(<span class="hljs-params">l, r, rt, x, y</span>):<br>    <span class="hljs-keyword">if</span> x &lt;= l <span class="hljs-keyword">and</span> r &lt;= y:<br>        <span class="hljs-keyword">return</span> s[rt]<br>    <span class="hljs-keyword">if</span> y &lt;= (l + r) // <span class="hljs-number">2</span>:<br>        <span class="hljs-keyword">return</span> query(l, (l + r) // <span class="hljs-number">2</span>, rt * <span class="hljs-number">2</span>, x, y)<br>    <span class="hljs-keyword">if</span> x &gt; (l + r) // <span class="hljs-number">2</span>:<br>        <span class="hljs-keyword">return</span> query((l + r) // <span class="hljs-number">2</span> + <span class="hljs-number">1</span>, r, rt * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>, x, y)<br>    <span class="hljs-keyword">return</span> query(l, (l + r) // <span class="hljs-number">2</span>, rt * <span class="hljs-number">2</span>, x, y) + query((l + r) // <span class="hljs-number">2</span> + <span class="hljs-number">1</span>, r, rt * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>, x, y)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">modify</span>(<span class="hljs-params">l, r, rt, ad, ch</span>):<br>    <span class="hljs-keyword">if</span> l == r:<br>        s[rt] = asdf(<span class="hljs-built_in">ord</span>(ch), <span class="hljs-built_in">ord</span>(ch), <span class="hljs-number">1</span>)<br>        <span class="hljs-keyword">return</span> s[rt]<br>    <span class="hljs-keyword">if</span> ad &lt;= (l + r) // <span class="hljs-number">2</span>:<br>        s[rt] = modify(l, (l + r) // <span class="hljs-number">2</span>, rt * <span class="hljs-number">2</span>, ad, ch) + s[rt * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>]<br>    <span class="hljs-keyword">else</span>:<br>        s[rt] = s[rt * <span class="hljs-number">2</span>] + modify((l + r) // <span class="hljs-number">2</span> + <span class="hljs-number">1</span>, r, rt * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>, ad, ch)<br>    <span class="hljs-keyword">return</span> s[rt]<br><br>n = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>())<br>a = <span class="hljs-built_in">input</span>()<br>a = <span class="hljs-string">&quot;!&quot;</span> + a<br>bs1.append(<span class="hljs-number">1</span>)<br>bs2.append(<span class="hljs-number">1</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>    bs1.append(bs1[i]*bas%mod1)<br>    bs2.append(bs2[i]*bas%mod2)<br>s = [<span class="hljs-literal">None</span>] * (<span class="hljs-number">4</span> * (n+<span class="hljs-number">5</span>))<br>build(<span class="hljs-number">1</span>, n, <span class="hljs-number">1</span>)<br><br>q = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>())<br><span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(q):<br>    ls=<span class="hljs-built_in">input</span>().split()<br>    opt = ls[<span class="hljs-number">0</span>]<br>    <span class="hljs-keyword">if</span> opt == <span class="hljs-string">&#x27;1&#x27;</span>:<br>        ad = <span class="hljs-built_in">int</span>(ls[<span class="hljs-number">1</span>])<br>        ch = ls[<span class="hljs-number">2</span>]<br>        modify(<span class="hljs-number">1</span>, n, <span class="hljs-number">1</span>, <span class="hljs-built_in">int</span>(ad), ch)<br>    <span class="hljs-keyword">else</span>:<br>        l1 = <span class="hljs-built_in">int</span>(ls[<span class="hljs-number">1</span>])<br>        r1 = <span class="hljs-built_in">int</span>(ls[<span class="hljs-number">2</span>])<br>        l2 = <span class="hljs-built_in">int</span>(ls[<span class="hljs-number">3</span>])<br>        r2 = <span class="hljs-built_in">int</span>(ls[<span class="hljs-number">4</span>])<br>        x = query(<span class="hljs-number">1</span>, n, <span class="hljs-number">1</span>, l1, r1)<br>        y = query(<span class="hljs-number">1</span>, n, <span class="hljs-number">1</span>, l2, r2)<br>        <span class="hljs-keyword">if</span> x == y:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;YES&quot;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;NO&quot;</span>)<br></code></pre></td></tr></table></figure>
<h3 id="可持久化线段树"><a href="#可持久化线段树" class="headerlink" title="可持久化线段树"></a>可持久化线段树</h3><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526122146448.png" alt="image-20240526122146448"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526122158524.png" alt="image-20240526122158524"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526122211004.png" alt="image-20240526122211004"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526122219620.png" alt="image-20240526122219620"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526122228761.png" alt="image-20240526122228761"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526122248198.png" alt="image-20240526122248198"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526122258158.png" alt="image-20240526122258158"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526122329330.png" alt="image-20240526122329330"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526122339224.png" alt="image-20240526122339224"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526122353739.png" alt="image-20240526122353739"></p>
<h4 id="可持久化线段树-1"><a href="#可持久化线段树-1" class="headerlink" title="可持久化线段树"></a>可持久化线段树</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">NODE</span> &#123;</span><br>    <span class="hljs-type">int</span> v, ls, rs;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">SEGTREE</span> &#123;</span><br>    <span class="hljs-type">int</span> cnt = <span class="hljs-number">0</span>;<br>    <span class="hljs-type">int</span> root[MAXN &lt;&lt; <span class="hljs-number">5</span>];<br>    NODE node[MAXN &lt;&lt; <span class="hljs-number">5</span>];<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">SEGTREE::update</span><span class="hljs-params">(<span class="hljs-type">int</span> <span class="hljs-type">_t</span>, <span class="hljs-type">int</span> &amp;t, <span class="hljs-type">int</span> l, <span class="hljs-type">int</span> r, <span class="hljs-type">int</span> pos, <span class="hljs-type">int</span> k)</span> &#123;<br>    <span class="hljs-keyword">if</span> (!t) &#123;<br>        t = ++cnt;<br>        node[t].v = node[<span class="hljs-type">_t</span>].v;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (l == r) &#123;<br>        node[t].v += k;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-type">int</span> mid = (l + r) &gt;&gt; <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">if</span> (pos &lt;= mid) &#123;<br>        node[t].rs = node[<span class="hljs-type">_t</span>].rs;<br>        update(node[<span class="hljs-type">_t</span>].ls, node[t].ls, l, mid, pos, k);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        node[t].ls = node[<span class="hljs-type">_t</span>].ls;<br>        update(node[<span class="hljs-type">_t</span>]).rs, node[t].rs, mid + <span class="hljs-number">1</span>, r, pos, k);<br>    &#125;<br>    node[t].v = node[node[t].ls].v + node[node[t].rs].v;<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">SEGTREE::getV</span><span class="hljs-params">(<span class="hljs-type">int</span> t, <span class="hljs-type">int</span> _l, <span class="hljs-type">int</span> _r, <span class="hljs-type">int</span> l, <span class="hljs-type">int</span> r)</span> &#123;<br>    <span class="hljs-keyword">if</span> (!t) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (l == _l &amp;&amp; r == _r) &#123;<br>        <span class="hljs-keyword">return</span> node[t].v;<br>    &#125;<br>    <span class="hljs-type">int</span> mid = (_l + _r) &gt;&gt; <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">if</span> (r &lt;= mid) &#123;<br>        <span class="hljs-keyword">return</span> getV(node[t].ls, _l, mid, l, r);<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (l &gt; mid) &#123;<br>        <span class="hljs-keyword">return</span> getV(node[t].rs, mid + <span class="hljs-number">1</span>, _r, l, r);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> getV(node[t].ls, _l, mid, l, mid)<br>            + getV(node[t].rs, mid + <span class="hljs-number">1</span>, _r, mid + <span class="hljs-number">1</span>, r);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="模板题——区间第k小"><a href="#模板题——区间第k小" class="headerlink" title="模板题——区间第k小"></a>模板题——<a target="_blank" rel="noopener" href="https://www.lanqiao.cn/problems/1132/learning/">区间第k小</a></h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;bits/stdc++.h&gt;</span></span><br>using namespace <span class="hljs-built_in">std</span>;<br><span class="hljs-meta">#<span class="hljs-keyword">define</span> lc(x) tr[x].l</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> rc(x) tr[x].r</span><br><span class="hljs-type">const</span> <span class="hljs-type">int</span> N=<span class="hljs-number">2e5</span>+<span class="hljs-number">6</span>;<br><span class="hljs-type">int</span> n,m,a[N],b[N];<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Node</span> &#123;</span><br> <span class="hljs-type">int</span> l,r,s;<span class="hljs-comment">//左右儿子，该节点在值域中的个数</span><br>&#125;tr[N*<span class="hljs-number">20</span>];<br><span class="hljs-type">int</span> idx,root[N];<br><span class="hljs-type">void</span> <span class="hljs-title function_">build</span><span class="hljs-params">(<span class="hljs-type">int</span> &amp;x,<span class="hljs-type">int</span> l,<span class="hljs-type">int</span> r)</span><br>&#123;<br>    x=++idx;<br>    <span class="hljs-keyword">if</span>(l==r)<span class="hljs-keyword">return</span> ;<br>    <span class="hljs-type">int</span> mid=(l+r)&gt;&gt;<span class="hljs-number">1</span>;<br>    build(lc(x),l,mid);<br>    build(rc(x),mid+<span class="hljs-number">1</span>,r);<br>&#125;<br><span class="hljs-type">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">(<span class="hljs-type">int</span> x,<span class="hljs-type">int</span> &amp;y,<span class="hljs-type">int</span> l,<span class="hljs-type">int</span> r,<span class="hljs-type">int</span> v)</span><br>&#123;<br>    y=++idx;<br>    tr[y]=tr[x];<br>    tr[y].s++;<br>    <span class="hljs-keyword">if</span>(l==r)<span class="hljs-keyword">return</span>;<br>    <span class="hljs-type">int</span> mid=(l+r)&gt;&gt;<span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">if</span>(v&lt;=mid)<br>        update(lc(x),lc(y),l,mid,v);<br>    <span class="hljs-keyword">else</span><br>        update(rc(x),rc(y),mid+<span class="hljs-number">1</span>,r,v);<br>&#125;<br><span class="hljs-type">int</span> <span class="hljs-title function_">query</span><span class="hljs-params">(<span class="hljs-type">int</span> x,<span class="hljs-type">int</span> y,<span class="hljs-type">int</span> l,<span class="hljs-type">int</span> r,<span class="hljs-type">int</span> k)</span><br>&#123;<br>    <span class="hljs-keyword">if</span>(l==r)<span class="hljs-keyword">return</span> l;<br>    <span class="hljs-type">int</span> mid=(l+r)&gt;&gt;<span class="hljs-number">1</span>;<br>    <span class="hljs-type">int</span> s=tr[lc(y)].s-tr[lc(x)].s;<br>    <span class="hljs-keyword">if</span>(k&lt;=s)<br>        <span class="hljs-keyword">return</span> query(lc(x),lc(y),l,mid,k);<br>    <span class="hljs-keyword">else</span> <br>        <span class="hljs-keyword">return</span> query(rc(x),rc(y),mid+<span class="hljs-number">1</span>,r,k-s);<br>&#125;<br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    ios::sync_with_stdio(<span class="hljs-number">0</span>),<span class="hljs-built_in">cin</span>.tie(<span class="hljs-number">0</span>),<span class="hljs-built_in">cout</span>.tie(<span class="hljs-number">0</span>);<br>    <span class="hljs-built_in">cin</span>&gt;&gt;n&gt;&gt;m;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++)<br>    &#123;<br>        <span class="hljs-built_in">cin</span>&gt;&gt;a[i];<br>        b[i]=a[i];<br>    &#125;<br>    sort(b+<span class="hljs-number">1</span>,b+<span class="hljs-number">1</span>+n);<br>    <span class="hljs-type">int</span> bn=unique(b+<span class="hljs-number">1</span>,b+<span class="hljs-number">1</span>+n)-b<span class="hljs-number">-1</span>;<br>    build(root[<span class="hljs-number">0</span>],<span class="hljs-number">1</span>,bn);<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++)<br>    &#123;<br>        <span class="hljs-type">int</span> id=lower_bound(b+<span class="hljs-number">1</span>,b+<span class="hljs-number">1</span>+bn,a[i])-b;<br>        update(root[i<span class="hljs-number">-1</span>],root[i],<span class="hljs-number">1</span>,bn,id);<br>    &#125;<br>    <span class="hljs-keyword">while</span>(m--)<br>    &#123;<br>        <span class="hljs-type">int</span> l,r,k;<br>        <span class="hljs-built_in">cin</span>&gt;&gt;l&gt;&gt;r&gt;&gt;k;<br>        <span class="hljs-type">int</span> id=query(root[l<span class="hljs-number">-1</span>],root[r],<span class="hljs-number">1</span>,bn,k);<br>        <span class="hljs-built_in">cout</span>&lt;&lt;b[id]&lt;&lt;<span class="hljs-string">&#x27;\n&#x27;</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="扫描线与二维数点"><a href="#扫描线与二维数点" class="headerlink" title="扫描线与二维数点"></a>扫描线与二维数点</h3><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526122721288.png" alt="image-20240526122721288"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526122730203.png" alt="image-20240526122730203"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526122740484.png" alt="image-20240526122740484"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526122748677.png" alt="image-20240526122748677"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526122757899.png" alt="image-20240526122757899"></p>
<h4 id="二维数点"><a href="#二维数点" class="headerlink" title="二维数点"></a>二维数点</h4><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526122820094.png" alt="image-20240526122820094"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526122808099.png" alt="image-20240526122808099"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526122858486.png" alt="image-20240526122858486"></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;bits/stdc++.h&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-meta">#<span class="hljs-keyword">define</span> maxn 110000</span><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Point</span>&#123;<br>    <span class="hljs-type">int</span> x,y;<br>&#125;point[maxn];<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Rect</span>&#123;<br>    <span class="hljs-type">int</span> p1,p2,q1,q2,id;<br>&#125;rect[maxn];<br><span class="hljs-type">int</span> n,m,ans[maxn];<br><span class="hljs-type">int</span> len[maxn],cnt;<br><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">cmp</span><span class="hljs-params">(<span class="hljs-type">const</span> Point &amp;a,<span class="hljs-type">const</span> Point &amp;b)</span></span>&#123;<br>    <span class="hljs-keyword">return</span> a.x &lt; b.x;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">cmp1</span><span class="hljs-params">(<span class="hljs-type">const</span> Rect &amp;a,<span class="hljs-type">const</span> Rect &amp;b)</span></span>&#123;<br>    <span class="hljs-keyword">return</span> a.p1&lt;b.p1;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">cmp2</span><span class="hljs-params">(<span class="hljs-type">const</span> Rect &amp;a,<span class="hljs-type">const</span> Rect &amp;b)</span></span>&#123;<br>    <span class="hljs-keyword">return</span> a.q1&lt;b.q1;<br>&#125;<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Node</span>&#123;<br>    <span class="hljs-type">int</span> sum;<br>&#125;tree[maxn&lt;&lt;<span class="hljs-number">1</span>];<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">pushup</span><span class="hljs-params">(<span class="hljs-type">int</span> rt)</span></span>&#123;<br>    tree[rt].sum=tree[rt&lt;&lt;<span class="hljs-number">1</span>].sum+tree[rt&lt;&lt;<span class="hljs-number">1</span>|<span class="hljs-number">1</span>].sum;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-type">int</span> rt,<span class="hljs-type">int</span> l,<span class="hljs-type">int</span> r,<span class="hljs-type">int</span> x)</span></span>&#123;<br>    <span class="hljs-keyword">if</span>(l==r)&#123;<br>        <span class="hljs-keyword">if</span>(l==x)tree[rt].sum+=<span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">return</span> ;<br>    &#125;<br>    <span class="hljs-type">int</span> mid=(l+r)&gt;&gt;<span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">if</span>(x&lt;=mid)<span class="hljs-built_in">add</span>(rt&lt;&lt;<span class="hljs-number">1</span>,l,mid,x);<br>    <span class="hljs-keyword">if</span>(x&gt;mid)<span class="hljs-built_in">add</span>(rt&lt;&lt;<span class="hljs-number">1</span>|<span class="hljs-number">1</span>,mid+<span class="hljs-number">1</span>,r,x);<br>    <span class="hljs-built_in">pushup</span>(rt);<br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">query</span><span class="hljs-params">(<span class="hljs-type">int</span> rt,<span class="hljs-type">int</span> l,<span class="hljs-type">int</span> r,<span class="hljs-type">int</span> x,<span class="hljs-type">int</span> y)</span></span>&#123;<br>    <span class="hljs-keyword">if</span>(x&lt;=l&amp;&amp;r&lt;=y)&#123;<br>        <span class="hljs-keyword">return</span> tree[rt].sum;<br>    &#125;<br>    <span class="hljs-type">int</span> mid=(l+r)&gt;&gt;<span class="hljs-number">1</span>;<br>    <span class="hljs-type">int</span> ans=<span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">if</span>(x&lt;=mid)ans+=<span class="hljs-built_in">query</span>(rt&lt;&lt;<span class="hljs-number">1</span>,l,mid,x,y);<br>    <span class="hljs-keyword">if</span>(y&gt;mid)ans+=<span class="hljs-built_in">query</span>(rt&lt;&lt;<span class="hljs-number">1</span>|<span class="hljs-number">1</span>,mid+<span class="hljs-number">1</span>,r,x,y);<br>    <span class="hljs-built_in">pushup</span>(rt);<br>    <span class="hljs-keyword">return</span> ans;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d%d&quot;</span>,&amp;n,&amp;m);<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++)&#123;<br>        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d%d&quot;</span>,&amp;point[i].x,&amp;point[i].y);<br>        len[++cnt]=point[i].x,len[++cnt]=point[i].y;<br>    &#125;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=m;i++)&#123;<br>        <span class="hljs-type">int</span> a,b,c,d;<br>        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d%d%d%d&quot;</span>,&amp;a,&amp;b,&amp;c,&amp;d);<br>        rect[i]=&#123;a,b,c,d,i&#125;;<br>        len[++cnt]=a;len[++cnt]=b;len[++cnt]=c;len[++cnt]=d;<br>    &#125;<br>    <span class="hljs-built_in">sort</span>(len+<span class="hljs-number">1</span>,len+cnt+<span class="hljs-number">1</span>);<br>    <span class="hljs-type">int</span> tot=<span class="hljs-built_in">unique</span>(len+<span class="hljs-number">1</span>,len+cnt+<span class="hljs-number">1</span>)-len<span class="hljs-number">-1</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++)&#123;<br>        point[i].x=<span class="hljs-built_in">lower_bound</span>(len+<span class="hljs-number">1</span>,len+cnt+<span class="hljs-number">1</span>,point[i].x)-len;<br>        point[i].y=<span class="hljs-built_in">lower_bound</span>(len+<span class="hljs-number">1</span>,len+cnt+<span class="hljs-number">1</span>,point[i].y)-len;<br>    &#125;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=m;i++)&#123;<br>        rect[i].p1=<span class="hljs-built_in">lower_bound</span>(len+<span class="hljs-number">1</span>,len+cnt+<span class="hljs-number">1</span>,rect[i].p1)-len;<br>        rect[i].q1=<span class="hljs-built_in">lower_bound</span>(len+<span class="hljs-number">1</span>,len+cnt+<span class="hljs-number">1</span>,rect[i].q1)-len;<br>        rect[i].p2=<span class="hljs-built_in">lower_bound</span>(len+<span class="hljs-number">1</span>,len+cnt+<span class="hljs-number">1</span>,rect[i].p2)-len;<br>        rect[i].q1=<span class="hljs-built_in">lower_bound</span>(len+<span class="hljs-number">1</span>,len+cnt+<span class="hljs-number">1</span>,rect[i].q2)-len;<br>    &#125;<br>    <span class="hljs-built_in">sort</span>(point+<span class="hljs-number">1</span>,point+n+<span class="hljs-number">1</span>,cmp);<br>    <span class="hljs-built_in">sort</span>(rect+<span class="hljs-number">1</span>,rect+m+<span class="hljs-number">1</span>,cmp1);<br>    <span class="hljs-type">int</span> pos=<span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=m;i++)&#123;<br>        <span class="hljs-keyword">while</span>(rect[i].p1&gt;point[pos+<span class="hljs-number">1</span>].x&amp;&amp;pos&lt;=n)&#123;<br>            pos+=<span class="hljs-number">1</span>;<br>            <span class="hljs-built_in">add</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,n,point[i].y);<br>        &#125;<br>        ans[rect[i].id]-=<span class="hljs-built_in">query</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,n,rect[i].p2,rect[i].q2);<br>    &#125;<br>    <span class="hljs-built_in">memset</span>(tree,<span class="hljs-number">0</span>,<span class="hljs-built_in">sizeof</span>(tree));<br>    <span class="hljs-built_in">sort</span>(rect+<span class="hljs-number">1</span>,rect+m+<span class="hljs-number">1</span>,cmp);<br>    pos=<span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=m;i++)&#123;<br>        <span class="hljs-keyword">while</span>(rect[i].q1&gt;=point[pos+<span class="hljs-number">1</span>].x&amp;&amp;pos&lt;=n)&#123;<br>            pos+=<span class="hljs-number">1</span>;<br>            <span class="hljs-built_in">add</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,n,pos[i].y);<br>        &#125;<br>        ans[rect[i].id]+=<span class="hljs-built_in">query</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,n,rect[i].p2,rect[i].q2);<br>    &#125;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=m;i++)<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d\n&quot;</span>,ans[i]);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="平衡树-Splay"><a href="#平衡树-Splay" class="headerlink" title="平衡树-Splay"></a>平衡树-Splay</h3><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526122034271.png" alt="image-20240526122034271"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526122046309.png" alt="image-20240526122046309"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526122055269.png" alt="image-20240526122055269"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526122104347.png" alt="image-20240526122104347"></p>
<h3 id="平衡树-FHQ-Treap"><a href="#平衡树-FHQ-Treap" class="headerlink" title="平衡树-FHQ_Treap"></a>平衡树-FHQ_Treap</h3><h4 id="无旋Treap"><a href="#无旋Treap" class="headerlink" title="无旋Treap"></a>无旋Treap</h4><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526115339167.png" alt="image-20240526115339167"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526115350766.png" alt="image-20240526115350766"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526115359404.png" alt="image-20240526115359404"></p>
<h4 id="无旋Treap的结构"><a href="#无旋Treap的结构" class="headerlink" title="无旋Treap的结构"></a>无旋Treap的结构</h4><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526115559180.png" alt="image-20240526115559180"></p>
<h4 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h4><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526115614042.png" alt="image-20240526115614042"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526115623744.png" alt="image-20240526115623744"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526115634558.png" alt="image-20240526115634558"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526115644061.png" alt="image-20240526115644061"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526115650541.png" alt="image-20240526115650541"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526115656903.png" alt="image-20240526115656903"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526115703005.png" alt="image-20240526115703005"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526115710056.png" alt="image-20240526115710056"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526115715945.png" alt="image-20240526115715945"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526115721051.png" alt="image-20240526115721051"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526115727235.png" alt="image-20240526115727235"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526115734944.png" alt="image-20240526115734944"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526115740418.png" alt="image-20240526115740418"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526115746149.png" alt="image-20240526115746149"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526115751158.png" alt="image-20240526115751158"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526115755059.png" alt="image-20240526115755059"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526115800730.png" alt="image-20240526115800730"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526115804490.png" alt="image-20240526115804490"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526115808715.png" alt="image-20240526115808715"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526115813454.png" alt="image-20240526115813454"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526115817884.png" alt="image-20240526115817884"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526115823342.png" alt="image-20240526115823342"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526115830400.png" alt="image-20240526115830400"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526115835300.png" alt="image-20240526115835300"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526115839426.png" alt="image-20240526115839426"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526115847061.png" alt="image-20240526115847061"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526115851600.png" alt="image-20240526115851600"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526115858903.png" alt="image-20240526115858903"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526115904405.png" alt="image-20240526115904405"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526115910595.png" alt="image-20240526115910595"><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526115916421.png" alt="image-20240526115916421"><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526115922564.png" alt="image-20240526115922564"><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526115926736.png" alt="image-20240526115926736"><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526115931678.png" alt="image-20240526115931678"><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526115936852.png" alt="image-20240526115936852"><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526115942072.png" alt="image-20240526115942072"><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526115948947.png" alt="image-20240526115948947"><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526115954070.png" alt="image-20240526115954070"><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526115959511.png" alt="image-20240526115959511"><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526120003232.png" alt="image-20240526120003232"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526120022163.png" alt="image-20240526120022163"><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526120026713.png" alt="image-20240526120026713"><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526120031817.png" alt="image-20240526120031817"><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526120036416.png" alt="image-20240526120036416"><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526120040832.png" alt="image-20240526120040832"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526120053497.png" alt="image-20240526120053497"><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526120100194.png" alt="image-20240526120100194"><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526120104721.png" alt="image-20240526120104721"><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526120109696.png" alt="image-20240526120109696"></p>
<h4 id="案例-1"><a href="#案例-1" class="headerlink" title="案例"></a>案例</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">NODE</span> &#123;</span><br>    <span class="hljs-type">int</span> val;<br>    <span class="hljs-type">int</span> cnt;<br>    <span class="hljs-type">int</span> rev;<br>    <span class="hljs-type">int</span> prio;<br>    <span class="hljs-type">int</span> size;<br>    <span class="hljs-type">int</span> ch[<span class="hljs-number">2</span>];<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">FHQTREAP</span> &#123;</span><br>    <span class="hljs-type">int</span> root;<br>    <span class="hljs-type">int</span> size;<br>    NODE node[MAXN];<br>&#125;<br><br><span class="hljs-built_in">pair</span>&lt;<span class="hljs-type">int</span>, <span class="hljs-type">int</span>&gt; <span class="hljs-title function_">split_by_val</span><span class="hljs-params">(<span class="hljs-type">int</span> t, <span class="hljs-type">int</span> val)</span> &#123;<br>    <span class="hljs-keyword">if</span> (!t) &#123;<br>        <span class="hljs-keyword">return</span> &#123;<span class="hljs-number">0</span>, <span class="hljs-number">0</span>&#125;;<br>    &#125;<br>    check_rev(t);<br>    <span class="hljs-keyword">if</span> (node[t].val &lt;= val) &#123;<br>        <span class="hljs-keyword">auto</span> tmp = split_by_val(node[t].ch[<span class="hljs-number">1</span>], val);<br>        node[t].ch[<span class="hljs-number">1</span>] = tmp.first;<br>        update_size(t);<br>        <span class="hljs-keyword">return</span> &#123;t, tmp.second&#125;;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">auto</span> tmp = split_by_val(node[t].ch[<span class="hljs-number">0</span>], val);<br>        node[t].ch[<span class="hljs-number">0</span>] = tmp.second;<br>        update_size(t);<br>        <span class="hljs-keyword">return</span> &#123;tmp.first, t&#125;;<br>    &#125;<br>&#125;<br><br>tuple&lt;<span class="hljs-type">int</span>, <span class="hljs-type">int</span>, <span class="hljs-type">int</span>&gt; <span class="hljs-title function_">split_by_rank</span><span class="hljs-params">(<span class="hljs-type">int</span> t, <span class="hljs-type">int</span> k)</span> &#123;<br>    <span class="hljs-keyword">if</span> (!t) &#123;<br>        <span class="hljs-keyword">return</span> &#123;<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>&#125;;<br>    &#125;<br>    check_rev(t);<br>    <span class="hljs-type">int</span> lt, mt, rt;<br>    <span class="hljs-keyword">if</span> (k &lt;= node[node[t].ch[<span class="hljs-number">0</span>]].size()) &#123;<br>        tie(lt, mt, rt) = split_by_rank(node[t].ch[<span class="hljs-number">0</span>], k);<br>        node[t].ch[<span class="hljs-number">0</span>] = rt;<br>        update_size(t);<br>        <span class="hljs-keyword">return</span> &#123;lt, mt, t&#125;;<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (k &gt; node[node[t]].ch[<span class="hljs-number">0</span>].size() + node[t].cnt) &#123;<br>        tie(lt, mt, rt) = split_by_rank(node[t].ch[<span class="hljs-number">1</span>], k - node[node[t].ch[<span class="hljs-number">0</span>]].size() - node[t].cnt);<br>        node[t].ch[<span class="hljs-number">1</span>] = lt;<br>        update_size(t);<br>        <span class="hljs-keyword">return</span> &#123;t, mt, rt&#125;;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        lt = node[t].ch[<span class="hljs-number">0</span>];<br>        rt = node[t].ch[<span class="hljs-number">1</span>];<br>        check_rev(lt);<br>        check_rev(rt);<br>        node[t].ch[<span class="hljs-number">0</span>] = <span class="hljs-number">0</span>;<br>        upda[t].ch[<span class="hljs-number">1</span>] = <span class="hljs-number">0</span>;<br>        update_size(t);<br>        <span class="hljs-keyword">return</span> &#123;lt, t, rt&#125;;<br>    &#125;<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">merge</span><span class="hljs-params">(<span class="hljs-type">int</span> lt, <span class="hljs-type">int</span> rt)</span> &#123;<br>    <span class="hljs-keyword">if</span> (!lt) &#123;<br>        <span class="hljs-keyword">return</span> rt;<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!rt) &#123;<br>        <span class="hljs-keyword">return</span> lt;<br>    &#125;<br>    check_rev(lt);<br>    check_rev(rt);<br>    <span class="hljs-keyword">if</span> (node[lt].prio &lt; node[rt].prio) &#123;<br>        node[lt].ch[<span class="hljs-number">1</span>] = merge(node[lt].ch[<span class="hljs-number">1</span>], rt);<br>        update_size(lt);<br>        <span class="hljs-keyword">return</span> lt;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        node[rt].ch[<span class="hljs-number">0</span>] = merge(lt, node[rt].ch[<span class="hljs-number">0</span>]);<br>        update_size(rt);<br>        <span class="hljs-keyword">return</span> rt;<br>    &#125;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">insert</span><span class="hljs-params">(<span class="hljs-type">int</span> val)</span> &#123;<br>    <span class="hljs-type">int</span> lt, mt, rt;<br>    tie(lt, rt) = split_by_val(root, val);<br>    tie(lt, mt) = split_by_val(lt, val - <span class="hljs-number">1</span>);<br>    <span class="hljs-keyword">if</span> (!mt) &#123;<br>        mt = new_node(val);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        node[mt].cnt ++;<br>        update_size(mt);<br>    &#125;<br>    root = merge(merge(lt, mt), rt);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">del</span><span class="hljs-params">(<span class="hljs-type">int</span> val)</span> &#123;<br>    <span class="hljs-type">int</span> lt, mt, rt;<br>    tie(lt, rt) = split_by_val(root, val);<br>    tie(lt, mt) = split_by_val(lt, val - <span class="hljs-number">1</span>);<br>    unode[mt].cnt --;<br>    update_size(mt);<br>    <span class="hljs-keyword">if</span> (node[mt].cnt == <span class="hljs-number">0</span>) &#123;<br>        clear(mt);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        lt = merge(lt, mt);<br>    &#125;<br>    root = merge(lt, rt);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">reverse</span><span class="hljs-params">(<span class="hljs-type">int</span> l, <span class="hljs-type">int</span> r)</span> &#123;<br>    <span class="hljs-type">int</span> t1, t2, t3, t4, t5;<br>    tie(t1, t2, t3) = split_by_rank(root, l - <span class="hljs-number">1</span>);<br>    tie(t3, t4, t5) = split_by_ranl(t3, r - l + <span class="hljs-number">2</span>);<br>    node[t3].rev = <span class="hljs-number">1</span>;<br>    root = merge(merge(merge(merge(t1, t2), t3), t4), t5);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">check_rev</span><span class="hljs-params">(<span class="hljs-type">int</span> t)</span> &#123;<br>    <span class="hljs-keyword">if</span> (node[t].rev) &#123;<br>        swap(node[t].ch[<span class="hljs-number">0</span>], node[t].ch[<span class="hljs-number">1</span>]);<br>        node[node[t].ch[<span class="hljs-number">0</span>]].rev ^= <span class="hljs-number">1</span>;<br>        node[node[t].ch[<span class="hljs-number">1</span>]].rev ^= <span class="hljs-number">1</span>;<br>        node[t].rev = <span class="hljs-number">0</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">rank</span><span class="hljs-params">(<span class="hljs-type">int</span> val)</span> &#123;<br>    <span class="hljs-keyword">auto</span> tmp = split_by_val(root, val - <span class="hljs-number">1</span>);<br>    <span class="hljs-type">int</span> k = node[tmp.first].size + <span class="hljs-number">1</span>;<br>    root = merge(tmp.first, tmp.second);<br>    <span class="hljs-keyword">return</span> k;<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">kth</span><span class="hljs-params">(<span class="hljs-type">int</span> &amp;t, <span class="hljs-type">int</span> k)</span> &#123;<br>    <span class="hljs-type">int</span> lt, mt, rt;<br>    tie(lt, mt, rt) = split_by_rank(t, k);<br>    <span class="hljs-type">int</span> val = node[mt].val;<br>    t = merge(merge(lt, mt), rt);<br>    <span class="hljs-keyword">return</span> val;<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">pre</span><span class="hljs-params">(<span class="hljs-type">int</span> val)</span> &#123;<br>    <span class="hljs-keyword">auto</span> tmp = split_by_cal(root, val - <span class="hljs-number">1</span>);<br>    <span class="hljs-type">int</span> k = kth(tmp.first, node[tmp.first].size);<br>    root = merge(tmp.first, tmp.second);<br>    <span class="hljs-keyword">return</span> k;<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">nxt</span><span class="hljs-params">(<span class="hljs-type">int</span> val)</span> &#123;<br>    <span class="hljs-keyword">auto</span> tmp = split_by_val(root, val);<br>    <span class="hljs-type">int</span> k = kth(tmp.second, <span class="hljs-number">1</span>);<br>    root = merge(tmp.first, tmp.second);<br>    <span class="hljs-keyword">return</span> k;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="单调栈"><a href="#单调栈" class="headerlink" title="单调栈"></a>单调栈</h2><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526114259208.png" alt="image-20240526114259208"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526114322817.png" alt="image-20240526114322817"></p>
<h4 id="模板题——百亿富翁"><a href="#模板题——百亿富翁" class="headerlink" title="模板题——百亿富翁"></a>模板题——<a target="_blank" rel="noopener" href="https://www.lanqiao.cn/problems/1142/learning/">百亿富翁</a></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">right_bigger</span>():<br>  ans=[-<span class="hljs-number">1</span>]*n<br>  stack=[]<br>  <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>    <span class="hljs-keyword">while</span> stack <span class="hljs-keyword">and</span> h[stack[-<span class="hljs-number">1</span>]]&lt;h[i]:<br>      ans[stack[-<span class="hljs-number">1</span>]]=i+<span class="hljs-number">1</span><br>      stack.pop()<br>    stack.append(i)<br>  <span class="hljs-keyword">return</span> ans<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">left_bigger</span>():<br>  ans=[-<span class="hljs-number">1</span>]*n<br>  stack=[]<br>  <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n-<span class="hljs-number">1</span>,-<span class="hljs-number">1</span>,-<span class="hljs-number">1</span>):<br>    <span class="hljs-keyword">while</span> stack <span class="hljs-keyword">and</span> h[stack[-<span class="hljs-number">1</span>]]&lt;h[i]:<br>      ans[stack[-<span class="hljs-number">1</span>]]=i+<span class="hljs-number">1</span><br>      stack.pop()<br>    stack.append(i)<br>  <span class="hljs-keyword">return</span> ans<br><br><span class="hljs-keyword">import</span> sys<br>n=<span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>())<br>h=<span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>,<span class="hljs-built_in">input</span>().split()))<br><span class="hljs-built_in">print</span>(*left_bigger())<br><span class="hljs-built_in">print</span>(*right_bigger())<br></code></pre></td></tr></table></figure>
<h2 id="分块"><a href="#分块" class="headerlink" title="分块"></a>分块</h2><h1 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h1><h2 id="KMP-amp-字符串哈希"><a href="#KMP-amp-字符串哈希" class="headerlink" title="KMP&amp;字符串哈希"></a>KMP&amp;字符串哈希</h2><h3 id="模式匹配"><a href="#模式匹配" class="headerlink" title="模式匹配"></a>模式匹配</h3><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526100046139.png" alt="image-20240526100046139"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526100057701.png" alt="image-20240526100057701"><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526100110562.png" alt="image-20240526100110562"></p>
<h3 id="KMP算法"><a href="#KMP算法" class="headerlink" title="KMP算法"></a>KMP算法</h3><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526100136410.png" alt="image-20240526100136410"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526100148837.png" alt="image-20240526100148837"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526100157890.png" alt="image-20240526100157890"></p>
<p> <img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526100211778.png" alt="image-20240526100211778"><br> <img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526100221657.png" alt="image-20240526100221657"></p>
<h4 id="模板题——斤斤计较的小Z"><a href="#模板题——斤斤计较的小Z" class="headerlink" title="模板题——斤斤计较的小Z"></a>模板题——<a target="_blank" rel="noopener" href="https://www.lanqiao.cn/problems/2047/learning">斤斤计较的小Z</a></h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs py">Next = [<span class="hljs-number">0</span>] * <span class="hljs-number">1000010</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_next</span>(<span class="hljs-params">T</span>):<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-built_in">len</span>(T)):<br>        j = Next[i]<br>        <span class="hljs-keyword">while</span> j &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> T[i] != T[j]:<br>            j = Next[j]<br>        <span class="hljs-keyword">if</span> T[i] == T[j]:<br>            Next[i + <span class="hljs-number">1</span>] = j + <span class="hljs-number">1</span><br>        <span class="hljs-keyword">else</span>:<br>            Next[i + <span class="hljs-number">1</span>] = <span class="hljs-number">0</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">KMP</span>(<span class="hljs-params">s,t</span>):<br>    get_next(t)<br>    ans = <span class="hljs-number">0</span><br>    j = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(s)):<br>        <span class="hljs-keyword">while</span> j &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> s[i] != t[j]:<br>            j =  Next[j]<br>        <span class="hljs-keyword">if</span> s[i] == t[j]:<br>            j += <span class="hljs-number">1</span><br>        <span class="hljs-keyword">if</span> j == <span class="hljs-built_in">len</span>(t):<br>            ans += <span class="hljs-number">1</span><br>            j =  Next[j]<br>    <span class="hljs-keyword">return</span> ans<br>t = <span class="hljs-built_in">input</span>()<br>s = <span class="hljs-built_in">input</span>()<br><span class="hljs-built_in">print</span>(KMP(s,t))<br></code></pre></td></tr></table></figure>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-built_in">print</span>((<span class="hljs-keyword">lambda</span> s: <span class="hljs-built_in">input</span>().count(s))(<span class="hljs-built_in">input</span>()))<br></code></pre></td></tr></table></figure>
<h3 id="字符串哈希"><a href="#字符串哈希" class="headerlink" title="字符串哈希"></a>字符串哈希</h3><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526100452881.png" alt="image-20240526100452881"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526100509262.png" alt="image-20240526100509262"></p>
<h4 id="模板题——斤斤计较的小Z-1"><a href="#模板题——斤斤计较的小Z-1" class="headerlink" title="模板题——斤斤计较的小Z"></a>模板题——<a target="_blank" rel="noopener" href="https://www.lanqiao.cn/problems/2047/learning">斤斤计较的小Z</a></h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs py">t = <span class="hljs-built_in">input</span>()<br>s = <span class="hljs-built_in">input</span>()<br>m,n = <span class="hljs-built_in">len</span>(t), <span class="hljs-built_in">len</span>(s)<br>B = <span class="hljs-number">26</span><br>mod = <span class="hljs-number">1000000007</span><br><span class="hljs-built_in">hash</span> = [<span class="hljs-number">0</span>] * (n + <span class="hljs-number">1</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,n + <span class="hljs-number">1</span>):<br>    <span class="hljs-built_in">hash</span>[i] = <span class="hljs-built_in">hash</span>[i - <span class="hljs-number">1</span>] * B + <span class="hljs-built_in">ord</span>(s[i - <span class="hljs-number">1</span>]) - <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;A&#x27;</span>)<br>    <span class="hljs-built_in">hash</span>[i] %= mod<br><br>numT = <span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> t:<br>    numT = numT * B + <span class="hljs-built_in">ord</span>(c) - <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;A&#x27;</span>)<br>    numT %= mod<br>    <br>p = (B ** m) % mod<br>ans = <span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> l <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,n +<span class="hljs-number">1</span>):<br>    r = l + m - <span class="hljs-number">1</span><br>    <span class="hljs-keyword">if</span> r &gt; n:<br>        <span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">hash</span>[r] - <span class="hljs-built_in">hash</span>[l - <span class="hljs-number">1</span>] * p % mod + mod) % mod == numT:<br>        ans += <span class="hljs-number">1</span><br><span class="hljs-built_in">print</span>(ans)<br></code></pre></td></tr></table></figure>
<h2 id="Manacher"><a href="#Manacher" class="headerlink" title="Manacher"></a>Manacher</h2><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526101919972.png" alt="image-20240526101919972"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526101929004.png" alt="image-20240526101929004"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526101944468.png" alt="image-20240526101944468"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526101953533.png" alt="image-20240526101953533"></p>
<h3 id="模板"><a href="#模板" class="headerlink" title="模板"></a>模板</h3><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526102101694.png" alt="image-20240526102101694"></p>
<h2 id="字典树基础"><a href="#字典树基础" class="headerlink" title="字典树基础"></a>字典树基础</h2><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526123731966.png" alt="image-20240526123731966"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526123744464.png" alt="image-20240526123744464"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526123847593.png" alt="image-20240526123847593"></p>
<h4 id="模板题——前缀判定"><a href="#模板题——前缀判定" class="headerlink" title="模板题——前缀判定"></a>模板题——<a target="_blank" rel="noopener" href="https://www.lanqiao.cn/problems/1204/learning">前缀判定</a></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">TreeNode</span>():<br>  <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>    self.nodes = &#123;&#125;<br>  <br>  <span class="hljs-comment">#插入</span><br>  <span class="hljs-keyword">def</span> <span class="hljs-title function_">insert</span>(<span class="hljs-params">self,s</span>):<br>    curr = self<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> s:<br>      <span class="hljs-keyword">if</span> i <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> curr.nodes.keys():<br>        curr.nodes[i] = TreeNode()<br>      <span class="hljs-comment">#往下走</span><br>      curr = curr.nodes[i]<br>  <br>  <span class="hljs-comment">#检查是否为前缀</span><br>  <span class="hljs-keyword">def</span> <span class="hljs-title function_">pre</span>(<span class="hljs-params">self,s</span>):<br>    curr = self<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> s:<br>      <span class="hljs-keyword">if</span> i <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> curr.nodes.keys():<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>      curr = curr.nodes[i]<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br><br><br>n,m = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>,<span class="hljs-built_in">input</span>().split())<br>tree = TreeNode()<br><span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>  s = <span class="hljs-built_in">input</span>()<br>  tree.insert(s)<br><span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m):<br>  t = <span class="hljs-built_in">input</span>()<br>  <span class="hljs-keyword">if</span> tree.pre(t):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Y&#x27;</span>)<br>  <span class="hljs-keyword">else</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;N&#x27;</span>)<br></code></pre></td></tr></table></figure>
<h4 id="模板题——依依的瓶中信"><a href="#模板题——依依的瓶中信" class="headerlink" title="模板题——依依的瓶中信"></a>模板题——<a target="_blank" rel="noopener" href="https://www.lanqiao.cn/problems/3751/learning">依依的瓶中信</a></h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">多个字符串，求公共前缀长度问题，用字典树</span><br><span class="hljs-string">同一个字符串不可与自身比较：构建树的时候打标记，查找的时候清除标记，若标记为0，则说明当前在于自己比较，直接返回。</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">TreeNode</span>():<br>  <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>    self.nodes = &#123;&#125;          <span class="hljs-comment">#用于存放以当前点为根的子树</span><br>    self.value = <span class="hljs-number">1</span>           <span class="hljs-comment">#每可子树的权值，初始为1</span><br><br>  <span class="hljs-keyword">def</span> <span class="hljs-title function_">insert</span>(<span class="hljs-params">self,s</span>):<span class="hljs-comment">#建树</span><br>    <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> s:<br>      <span class="hljs-keyword">if</span> c <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> self.nodes.keys():     <span class="hljs-comment">#若不存在，则添加该子树</span><br>        self.nodes[c] = TreeNode()<br>      <span class="hljs-keyword">else</span>:<br>        self.nodes[c].value +=<span class="hljs-number">1</span>       <span class="hljs-comment">#若存在，则该子树的权值+1，</span><br>      self = self.nodes[c]          <span class="hljs-comment">#进入下一层</span><br><span class="hljs-comment">#&#123;1,a:&#123;2,b:&#123;2,c:&#123;1,&#125;&#125;&#125;,b:&#123;1,c:&#123;1&#125;&#125;&#125;</span><br><br>  <span class="hljs-keyword">def</span> <span class="hljs-title function_">commen_pre</span>(<span class="hljs-params">self,t</span>):  <span class="hljs-comment">#查找</span><br>    cnt = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> t:           <span class="hljs-comment">#该题不用判断c是否存在，因为每个点都存在</span><br>      <span class="hljs-keyword">if</span> self.nodes[c].value -<span class="hljs-number">1</span> == <span class="hljs-number">0</span>:    <span class="hljs-comment">#如果走到自己独有的节点上时，就返回其与其它子串的公共前缀长</span><br>        <span class="hljs-keyword">return</span> cnt<br>      cnt += <span class="hljs-number">1</span><br>      self = self.nodes[c]   <span class="hljs-comment">#进入下一层</span><br>    <span class="hljs-keyword">return</span> cnt    <span class="hljs-comment">#若自己本身就是某个串的前缀，则返回自己的长度</span><br><br>n = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>())<br>S =[]<br>tree = TreeNode() <span class="hljs-comment">#实例化根节点</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):  <span class="hljs-comment">#建树</span><br>  s = <span class="hljs-built_in">input</span>()<br>  S.append(s)<br>  tree.insert(s)<br><br><span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> S:      <span class="hljs-comment">#查找、统计</span><br>  <span class="hljs-built_in">print</span>(tree.commen_pre(s))<br></code></pre></td></tr></table></figure>
<h2 id="01tire"><a href="#01tire" class="headerlink" title="01tire"></a>01tire</h2><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526124139861.png" alt="image-20240526124139861"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526124148215.png" alt="image-20240526124148215"><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526124153033.png" alt="image-20240526124153033"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526124201442.png" alt="image-20240526124201442"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526124207236.png" alt="image-20240526124207236"><br><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526124211551.png" alt="image-20240526124211551"></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs py">maxn = <span class="hljs-number">210000</span><br>ch = [[<span class="hljs-number">0</span>]*<span class="hljs-number">2</span> <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(maxn)]<br>val = [<span class="hljs-number">0</span>]*maxn<br>n, ans, tot = <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">insert</span>(<span class="hljs-params">x</span>):<br>    <span class="hljs-keyword">global</span> tot<br>    now = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">31</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>):<br>        pos = ((x &gt;&gt; j) &amp; <span class="hljs-number">1</span>)<br>        <span class="hljs-keyword">if</span> ch[now][pos] == <span class="hljs-number">0</span>:<br>            tot += <span class="hljs-number">1</span><br>            ch[now][pos] = tot<br>        now = ch[now][pos]<br>    val[now] = x<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">query</span>(<span class="hljs-params">x</span>):<br>    now = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">31</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>):<br>        pos = ((x &gt;&gt; j) &amp; <span class="hljs-number">1</span>)<br>        <span class="hljs-keyword">if</span> ch[now][pos ^ <span class="hljs-number">1</span>] != <span class="hljs-number">0</span>:<br>            now = ch[now][pos ^ <span class="hljs-number">1</span>]<br>        <span class="hljs-keyword">else</span>:<br>            now = ch[now][pos]<br>    <span class="hljs-keyword">return</span> val[now]<br><br>n = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>())<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n+<span class="hljs-number">1</span>):<br>    x = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>())<br>    insert(x)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n+<span class="hljs-number">1</span>):<br>    ans = <span class="hljs-built_in">max</span>(ans, query(val[i]))<br><span class="hljs-built_in">print</span>(ans)<br></code></pre></td></tr></table></figure>
<h1 id="图论"><a href="#图论" class="headerlink" title="图论"></a>图论</h1><h2 id="基础-2"><a href="#基础-2" class="headerlink" title="基础"></a>基础</h2><h3 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h3><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526124949289.png" alt="image-20240526124949289"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526124958064.png" alt="image-20240526124958064"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526125006396.png" alt="image-20240526125006396"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526125013800.png" alt="image-20240526125013800"></p>
<h3 id="DFS-amp-BFS"><a href="#DFS-amp-BFS" class="headerlink" title="DFS&amp;BFS"></a>DFS&amp;BFS</h3><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526125134400.png" alt="image-20240526125134400"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526125142643.png" alt="image-20240526125142643"></p>
<h4 id="DFS模板题——帮派弟位"><a href="#DFS模板题——帮派弟位" class="headerlink" title="DFS模板题——帮派弟位"></a>DFS模板题——<a target="_blank" rel="noopener" href="https://www.lanqiao.cn/problems/3891/learning">帮派弟位</a></h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs py">n,m=<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>,<span class="hljs-built_in">input</span>().split())<br>G=[[] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n+<span class="hljs-number">1</span>)]<span class="hljs-comment">#bfs和图的结合</span><br>rudu=[<span class="hljs-number">0</span>]*(n+<span class="hljs-number">1</span>) <span class="hljs-comment">#计数，根结点是没有rudu的</span><br>biaoji=[<span class="hljs-number">0</span>]*(n+<span class="hljs-number">1</span>)<br><span class="hljs-built_in">sum</span>=[[<span class="hljs-number">0</span>,i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n+<span class="hljs-number">1</span>)] <span class="hljs-comment">#注意是二元组，记录子数数量，是先按数量排，再按序号排.然后是包括他自己的，所以初始化为1</span><br><span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n-<span class="hljs-number">1</span>):<br>    l,r=<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>,<span class="hljs-built_in">input</span>().split()) <span class="hljs-comment">#表示序号为l的人附属于r</span><br>    G[r].append(l) <span class="hljs-comment">#表示r下面有l 可以看出r和谁相邻</span><br>    rudu[l]+=<span class="hljs-number">1</span> <span class="hljs-comment">#表明l头上是有父亲的</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,n+<span class="hljs-number">1</span>): <span class="hljs-comment">#找出谁的rudu为0，即找出谁是根结点</span><br>    <span class="hljs-keyword">if</span> rudu[i]==<span class="hljs-number">0</span>:<br>        root=i<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">dfs</span>(<span class="hljs-params">u</span>):<br>    biaoji[u]=<span class="hljs-number">1</span> <span class="hljs-comment">#打上标记</span><br>    <span class="hljs-built_in">sum</span>[u][<span class="hljs-number">0</span>]=-<span class="hljs-number">1</span><span class="hljs-comment">#为什么这里设置成-1，而不是1呢，因为题目要求如果手下相同的，序号小的排在前面，设置成-1就可以这样了。！</span><br>    <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> G[u]: <span class="hljs-comment">#遍历和u相邻的每个节点</span><br>        <span class="hljs-keyword">if</span> biaoji[v]==<span class="hljs-number">0</span>: <span class="hljs-comment">#如果没有打上标记</span><br>            dfs(v)<span class="hljs-comment">#遍历和u相邻的节点，就是遍历子节点</span><br>            <span class="hljs-built_in">sum</span>[u][<span class="hljs-number">0</span>]+=<span class="hljs-built_in">sum</span>[v][<span class="hljs-number">0</span>] <span class="hljs-comment">#遍历v子节点的同时，可以把v下的子节点也加上去</span><br><br>dfs(root)<br><span class="hljs-built_in">sum</span>.sort()<br><span class="hljs-keyword">for</span> i,(x,y) <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(<span class="hljs-built_in">sum</span>,start=<span class="hljs-number">1</span>):<span class="hljs-comment">#输出小明的排列</span><br>    <span class="hljs-keyword">if</span> y==m:<br>        <span class="hljs-built_in">print</span>(i)<br>        <span class="hljs-keyword">break</span><br></code></pre></td></tr></table></figure>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526125335820.png" alt="image-20240526125335820"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526125344854.png" alt="image-20240526125344854"></p>
<h4 id="BFS模板题——最少操作数"><a href="#BFS模板题——最少操作数" class="headerlink" title="BFS模板题——最少操作数"></a>BFS模板题——<a target="_blank" rel="noopener" href="https://www.lanqiao.cn/problems/1509/learning">最少操作数</a></h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> deque<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">bfs</span>(<span class="hljs-params">s,t</span>):<br>    <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    :param s: 起点</span><br><span class="hljs-string">    :param t: 终点</span><br><span class="hljs-string">    :return:</span><br><span class="hljs-string">    &#x27;&#x27;&#x27;</span><br>    dis = [-<span class="hljs-number">1</span>]*<span class="hljs-number">100001</span><br>    queue = deque()<br>    <span class="hljs-comment">#1、将起点塞入到队列中，打上标记</span><br>    queue.append(s)<br>    dis[s] = <span class="hljs-number">0</span><br>    <span class="hljs-comment">#2、当队列非空</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-built_in">len</span>(queue) != <span class="hljs-number">0</span>:<br>        <span class="hljs-comment"># 2.1 取出队首元素u</span><br>        u = queue.popleft()<br>        <span class="hljs-comment">#2.2 判断u是否为终点</span><br>        <span class="hljs-keyword">if</span> u == t:<br>            <span class="hljs-keyword">return</span> dis[u]<br>        <span class="hljs-comment">#2.3 将u相连的所有点v，只要v未标记，则入队列</span><br>        <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> [u-<span class="hljs-number">1</span>,u+<span class="hljs-number">1</span>,u*<span class="hljs-number">2</span>]:<br>            <span class="hljs-comment">#特判：未越界、未标记</span><br>            <span class="hljs-keyword">if</span> <span class="hljs-number">0</span>&lt;=v&lt;=<span class="hljs-number">100000</span> <span class="hljs-keyword">and</span> dis[v] == -<span class="hljs-number">1</span>:<br>                queue.append(v)<br>                dis[v] = dis[u] + <span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span><br><br>n,k = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>,<span class="hljs-built_in">input</span>().split())<br><span class="hljs-built_in">print</span>(bfs(n,k))<br></code></pre></td></tr></table></figure>
<h4 id="BFS模板题——混境之地4"><a href="#BFS模板题——混境之地4" class="headerlink" title="BFS模板题——混境之地4"></a>BFS模板题——<a target="_blank" rel="noopener" href="https://www.lanqiao.cn/problems/3819/learning">混境之地4</a></h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> sys<br><br><span class="hljs-comment"># 请在此输入您的代码</span><br><span class="hljs-comment">#  3819 混境之地</span><br><span class="hljs-comment"># BFS遍历  经典题目</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string"></span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> deque  <span class="hljs-comment"># 使用队列</span><br>INF = <span class="hljs-number">0x3f3f3f3f</span>   <span class="hljs-comment"># 对应的十进制为：1061109567，一般的数据小于10^9，因此可将其作为一个边界</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">BFS</span>(<span class="hljs-params">x, y, dist</span>):<br>    <span class="hljs-comment"># 从(x, y)到每个点的最短时间</span><br>    queue = deque()<br>    vis = [[<span class="hljs-number">0</span>] * m <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n)]<br>    <span class="hljs-comment"># 1、将起点加入队列</span><br>    queue.append([x, y])<br>    dist[x][y] = <span class="hljs-number">0</span>  <span class="hljs-comment"># 更新距离</span><br>    vis[x][y] = <span class="hljs-number">1</span>  <span class="hljs-comment"># 打标记</span><br>    <span class="hljs-comment"># 2、当队列非空</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-built_in">len</span>(queue) != <span class="hljs-number">0</span>:<br>        x, y = queue.popleft()<br>        <span class="hljs-comment"># 对于每个相邻的点，都进行一次判断</span><br>        <span class="hljs-keyword">for</span> deltax, deltay <span class="hljs-keyword">in</span> [(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>), (<span class="hljs-number">0</span>, <span class="hljs-number">1</span>), (-<span class="hljs-number">1</span>, <span class="hljs-number">0</span>), (<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>)]:<br>            xx, yy = x + deltax, y + deltay<br>            <span class="hljs-comment"># 未越界、未标记、非障碍物</span><br>            <span class="hljs-keyword">if</span> <span class="hljs-number">0</span> &lt;= xx &lt; n  <span class="hljs-keyword">and</span> <span class="hljs-number">0</span> &lt;= yy &lt; m <span class="hljs-keyword">and</span> g[xx][yy] != <span class="hljs-string">&quot;#&quot;</span> <span class="hljs-keyword">and</span> vis[xx][yy] == <span class="hljs-number">0</span>:<br>                queue.append([xx, yy])<br>                dist[xx][yy] = dist[x][y] + <span class="hljs-number">1</span><br>                vis[xx][yy] = <span class="hljs-number">1</span><br><br><br>n, m = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>A, B, C, D = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>A, B, C, D = A-<span class="hljs-number">1</span>, B-<span class="hljs-number">1</span>, C-<span class="hljs-number">1</span>, D-<span class="hljs-number">1</span><br><span class="hljs-comment"># 输入图</span><br>g = [<span class="hljs-built_in">input</span>() <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n)]<br>E = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>())<br><span class="hljs-comment"># dist1[i][j]表示起点到(i, j)的最短时间</span><br>dist1 = [[INF] * m <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n)]  <span class="hljs-comment"># INF无穷大</span><br><span class="hljs-comment"># dist2[i][j]表示终点到(i, j)的最短时间</span><br>dist2 = [[INF] * m <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n)]<br><br>BFS(A, B, dist1)  <span class="hljs-comment"># 起点做一遍</span><br>BFS(C, D, dist2)  <span class="hljs-comment"># 终点做一遍</span><br><span class="hljs-comment"># 判断能否直接走到终点</span><br>res = dist1[C][D]<br><span class="hljs-keyword">if</span> res &lt;= E:<br>    <span class="hljs-built_in">print</span>(res)<br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-comment"># 枚举所有的圣泉</span><br>    res = INF<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m):<br>            <span class="hljs-comment"># 能量E不可小于0，可以等于0</span><br>            <span class="hljs-keyword">if</span> g[i][j] == <span class="hljs-string">&#x27;V&#x27;</span> <span class="hljs-keyword">and</span> dist1[i][j] &lt;= E:  <span class="hljs-comment"># 不需要经过多个圣泉</span><br>                res = <span class="hljs-built_in">min</span>(dist1[i][j] + dist2[i][j], res)<br>    <span class="hljs-comment"># 如果走不到圣泉</span><br>    <span class="hljs-keyword">if</span> res == INF:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;No&#x27;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-comment"># 初始能量为E，总共距离为res，相当于，后面的res-E需要花费两倍时间，因为需要等待能量恢复</span><br>        <span class="hljs-built_in">print</span>((res - E) * <span class="hljs-number">2</span> + E)<br></code></pre></td></tr></table></figure>
<h2 id="拓扑排序"><a href="#拓扑排序" class="headerlink" title="拓扑排序"></a>拓扑排序</h2><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526125845566.png" alt="image-20240526125845566"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526125853909.png" alt="image-20240526125853909"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526125908891.png" alt="image-20240526125908891"><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526125916425.png" alt="image-20240526125916425"></p>
<h4 id="模板题——走多远"><a href="#模板题——走多远" class="headerlink" title="模板题——走多远"></a>模板题——<a target="_blank" rel="noopener" href="https://www.lanqiao.cn/problems/1337/learning">走多远</a></h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> sys<br><br><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> deque<br><span class="hljs-comment"># INF = 0x3f3f3f3f</span><br><span class="hljs-comment"># 针对有向无环图，在进行拓扑排序时，可以进行状态转移</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">topo</span>():<br>    q = deque()<br>    <span class="hljs-comment"># 1。将入度为0的点加入队列中</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">if</span> ru[i] == <span class="hljs-number">0</span>:<br>            q.append(i)<br>    <span class="hljs-comment"># 2. 当队列非空</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-built_in">len</span>(q) != <span class="hljs-number">0</span>:<br>        <span class="hljs-comment"># 2.1 取出队首元素</span><br>        u = q.popleft()<br>        <span class="hljs-comment"># 2.2 对于和u相连的每个点v</span><br>        <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> G[u]:<br>            <span class="hljs-comment"># 从u走到v，说明dp[v]可以从dp[u]+1转移</span><br>            dp[v] = <span class="hljs-built_in">max</span>(dp[v], dp[u] + <span class="hljs-number">1</span>)<br>            <span class="hljs-comment"># 进行动态规划</span><br>            ru[v] -= <span class="hljs-number">1</span><br>            <span class="hljs-keyword">if</span> ru[v] == <span class="hljs-number">0</span>:<br>                q.append(v)<br><br>n, m = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br><span class="hljs-comment"># 图的存储——邻接表</span><br>G = [[] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n+<span class="hljs-number">1</span>)]<br>ru = [<span class="hljs-number">0</span>] * (n + <span class="hljs-number">1</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m):<br>    u, v = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>    G[u].append(v)<br>    ru[v] += <span class="hljs-number">1</span><br><span class="hljs-comment"># dp[i]表示走到i的最长路/最大值</span><br>dp = [<span class="hljs-number">0</span>] * (n + <span class="hljs-number">1</span>)<br>topo()<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">max</span>(dp))<br></code></pre></td></tr></table></figure>
<h4 id="模板题——最小字典序排列"><a href="#模板题——最小字典序排列" class="headerlink" title="模板题——最小字典序排列"></a>模板题——<a target="_blank" rel="noopener" href="https://www.lanqiao.cn/problems/3351/learning">最小字典序排列</a></h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> sys<br><br><span class="hljs-comment"># 3351 最小字典序排列</span><br><span class="hljs-comment"># 拓扑排序+优先队列</span><br><span class="hljs-comment"># 需要字典序最小的拓扑序列，只需要将普通队列转换成优先队列即可</span><br><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> deque<br><span class="hljs-keyword">from</span> queue <span class="hljs-keyword">import</span> PriorityQueue<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">topo</span>():<br>    q = PriorityQueue()<br>    <span class="hljs-comment"># 1。将入度为0的点加入队列中</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">if</span> ru[i] == <span class="hljs-number">0</span>:<br>            q.put(i) <span class="hljs-comment"># append改为put</span><br>    <span class="hljs-comment"># 2. 当队列非空</span><br>    ans = []<br>    <span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> q.empty(): <span class="hljs-comment"># 判断优先队列q是否非空</span><br>    <span class="hljs-comment"># while len(q.queue) != 0:</span><br>        <span class="hljs-comment"># 2.1 取出队首元素</span><br>        u = q.get()  <span class="hljs-comment"># popleft改为put</span><br>        ans.append(u)<br>        <span class="hljs-comment"># 2.2 对于和u相连的每个点v</span><br>        <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> G[u]:<br>            <span class="hljs-comment"># 进行动态规划</span><br>            ru[v] -= <span class="hljs-number">1</span><br>            <span class="hljs-keyword">if</span> ru[v] == <span class="hljs-number">0</span>:<br>                q.put(v)<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(ans) != n:<br>        <span class="hljs-built_in">print</span>(-<span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(*ans, sep = <span class="hljs-string">&#x27; &#x27;</span>)<br><br>n, m = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br><span class="hljs-comment"># 图的存储——邻接表</span><br>G = [[] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n+<span class="hljs-number">1</span>)]<br>ru = [<span class="hljs-number">0</span>] * (n + <span class="hljs-number">1</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m):<br>    u, v = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>    G[u].append(v)<br>    ru[v] += <span class="hljs-number">1</span><br>topo()<br></code></pre></td></tr></table></figure>
<h2 id="最短路"><a href="#最短路" class="headerlink" title="最短路"></a>最短路</h2><h3 id="Floyd"><a href="#Floyd" class="headerlink" title="Floyd"></a>Floyd</h3><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526130244161.png" alt="image-20240526130244161"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526130253653.png" alt="image-20240526130253653"></p>
<h4 id="模板题——-蓝桥公园"><a href="#模板题——-蓝桥公园" class="headerlink" title="模板题—— 蓝桥公园"></a>模板题——<a target="_blank" rel="noopener" href="https://www.lanqiao.cn/problems/1121/learning"> 蓝桥公园</a></h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> sys<br><span class="hljs-built_in">input</span>=sys.stdin.readline<br>n,m,q=<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>,<span class="hljs-built_in">input</span>().split())<br>inf=<span class="hljs-built_in">int</span>(<span class="hljs-number">1e18</span>)<br>dp=[[inf]*(n+<span class="hljs-number">1</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n+<span class="hljs-number">1</span>)]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,n+<span class="hljs-number">1</span>):<br>  dp[i][i]=<span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,m+<span class="hljs-number">1</span>):<br>  u,v,w=<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>,<span class="hljs-built_in">input</span>().split())<br>  dp[u][v]=dp[v][u]=<span class="hljs-built_in">min</span>(dp[u][v],w)<br><span class="hljs-comment">#Floyd 模板</span><br><span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,n+<span class="hljs-number">1</span>):<br>  <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,n+<span class="hljs-number">1</span>):<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,n+<span class="hljs-number">1</span>):<br>      dp[i][j]=<span class="hljs-built_in">min</span>(dp[i][j],dp[i][k]+dp[k][j])<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,n+<span class="hljs-number">1</span>):<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,n+<span class="hljs-number">1</span>):<br>      <span class="hljs-keyword">if</span> dp[i][j]==inf:<br>        dp[i][j]=-<span class="hljs-number">1</span><br><br><span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(q):<br>  s,e=<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>,<span class="hljs-built_in">input</span>().split())<br>  <span class="hljs-built_in">print</span>(dp[s][e])<br></code></pre></td></tr></table></figure>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-comment"># Floyd 算法  多个起点--多个终点  多源最短路算法（多对多）</span><br><span class="hljs-comment"># 最简单的最短路径算法</span><br><span class="hljs-comment"># 存图:最简单的矩阵存图</span><br><span class="hljs-comment"># 效率不高，不能用于大图</span><br><br><span class="hljs-comment"># 动态规划：求图上两点i,j之间的最短距离，按‘从小图到全图’的步骤，在逐步扩大图的过程中计算和更新最短路</span><br><span class="hljs-comment"># 定义状态：dp[k][i][j]: i,j,k是点的编号，范围1--n</span><br><span class="hljs-comment"># 状态dp[k][i][j]表示在包含1--k点的子图上，点对i,j之间的最短路</span><br><span class="hljs-comment"># 状态转移方程 从子图1-k-1 扩展到子图 1-k</span><br><span class="hljs-comment"># dp[k][i][j]=min(dp[k-1][i][j],dp[k-1][i][k]+dp[k-1][k][j])</span><br><span class="hljs-comment"># 初始值：i,j直连 就是他们的边长； 若不直连，赋值为无穷大 / 0x3f3f3f3f3f3f3f3f</span><br><span class="hljs-comment"># 滚动数组优化：dp[i][j]=min(dp[i][j],dp[i][k]+dp[k][j])</span><br><span class="hljs-comment">#                           不经过k     经过k</span><br><span class="hljs-comment"># for k in range(1,n+1):</span><br><span class="hljs-comment"># for i in range(1,n+1):</span><br><span class="hljs-comment"># for j in range(1,n+1):</span><br><span class="hljs-comment"># dp[i][j]=min(dp[i][j],dp[i][k]+dp[k][j])</span><br><span class="hljs-comment"># 只能用于n&lt;300 的小规模图</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">floyd</span>():<br>    <span class="hljs-keyword">global</span> dp<br>    <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,n+<span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):<br>            <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):<br>                dp[i][j]=<span class="hljs-built_in">min</span>(dp[i][j],dp[i][k]+dp[k][j])<br><span class="hljs-comment"># 蓝桥公园</span><br><span class="hljs-comment"># n个点 m条边 q次查询</span><br>n,m,q=<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>,<span class="hljs-built_in">input</span>().split())<br>INF = <span class="hljs-number">0x3f3f3f3f3f3f3f3f</span><br>dp=[[INF <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n+<span class="hljs-number">50</span>)] <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n+<span class="hljs-number">50</span>)]<br><span class="hljs-comment"># 记录路径</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,m+<span class="hljs-number">1</span>):<br>    u,v,w=<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>,<span class="hljs-built_in">input</span>().split())<br>    dp[u][v]=dp[v][u]=<span class="hljs-built_in">min</span>(dp[u][v],w)<br>floyd()<br><span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(q):<br>    start,end=<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>,<span class="hljs-built_in">input</span>().split())<br>    <span class="hljs-comment"># 无法到达</span><br>    <span class="hljs-keyword">if</span> dp[start][end]==INF:<br>        <span class="hljs-built_in">print</span>(-<span class="hljs-number">1</span>)<br>    <span class="hljs-comment"># 起点终点相同</span><br>    <span class="hljs-keyword">elif</span> start==end:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-number">0</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(dp[start][end])<br><br><span class="hljs-comment"># 1-12</span><br></code></pre></td></tr></table></figure>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> sys<br><br><span class="hljs-comment"># 请在此输入您的代码</span><br>N, M, Q = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>weight = [[<span class="hljs-number">0</span> <span class="hljs-keyword">if</span> i == j <span class="hljs-keyword">else</span> sys.maxsize <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(N + <span class="hljs-number">1</span>) ] <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(N + <span class="hljs-number">1</span>)]  <span class="hljs-comment"># 领接矩阵</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(M):<br>    u, v, w = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>    weight[u][v] = <span class="hljs-built_in">min</span>(weight[u][v], w)<br>    weight[v][u] = weight[u][v]<br><span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, N + <span class="hljs-number">1</span>):  <span class="hljs-comment"># N次递推</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, N + <span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(i + <span class="hljs-number">1</span>, N + <span class="hljs-number">1</span>):  <span class="hljs-comment"># 更新最小值</span><br>                weight[i][j] = <span class="hljs-built_in">min</span>(weight[i][j], weight[i][k] + weight[k][j])<br>                weight[j][i] = weight[i][j]<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(Q):<br>    st, ed = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>    t = weight[st][ed]<br>    <span class="hljs-keyword">if</span> t == sys.maxsize:<br>        <span class="hljs-built_in">print</span>(-<span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(t)<br></code></pre></td></tr></table></figure>
<h4 id="模板题——城市间的交易"><a href="#模板题——城市间的交易" class="headerlink" title="模板题——城市间的交易"></a>模板题——<a target="_blank" rel="noopener" href="https://www.lanqiao.cn/problems/8336/learning/">城市间的交易</a></h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> sys<br><br><span class="hljs-comment"># 请在此输入您的代码</span><br><span class="hljs-comment"># 8336 城市间的交易</span><br>INF =<span class="hljs-number">1e18</span><br>n, m = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br><span class="hljs-comment"># 产量、成本和售价</span><br>a, p, s = [<span class="hljs-number">0</span>] * (n+<span class="hljs-number">1</span>), [<span class="hljs-number">0</span>] * (n+<span class="hljs-number">1</span>), [<span class="hljs-number">0</span>] * (n+<span class="hljs-number">1</span>)<br>f = [[INF] * (n+<span class="hljs-number">1</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n+<span class="hljs-number">1</span>)]<br>g = [[<span class="hljs-number">0</span>] * (n+<span class="hljs-number">1</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n+<span class="hljs-number">1</span>)]<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n+<span class="hljs-number">1</span>):<br>    a[i], p[i], s[i] = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br><span class="hljs-comment"># 邻接矩阵初始化</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, m+<span class="hljs-number">1</span>):<br>    u, v, w = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>    f[u][v] = f[v][u] = <span class="hljs-built_in">min</span>(f[u][v], w)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n+<span class="hljs-number">1</span>):<br>    f[i][i] = <span class="hljs-number">0</span><br><br><span class="hljs-comment"># Floyd</span><br><span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n+<span class="hljs-number">1</span>):<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n+<span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n+<span class="hljs-number">1</span>):<br>            f[i][j] = <span class="hljs-built_in">min</span>(f[i][j], f[i][k]+f[k][j])<br><span class="hljs-comment"># g[i][j]表示城市i的物品运输到城市j可得到的利润 = 城市j的售价 - 城市i的成本 - 从i到j的运输成本</span><br>ans = <span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n+<span class="hljs-number">1</span>):<br>    <span class="hljs-comment"># 求每个城市的利润</span><br>    cnt = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n+<span class="hljs-number">1</span>):<br>        g[i][j] = s[j] - p[i] - f[i][j]<br>        cnt = <span class="hljs-built_in">max</span>(cnt, g[i][j])<br>    ans += a[i] * cnt<br><span class="hljs-built_in">print</span>(ans)<br></code></pre></td></tr></table></figure>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> sys<br>n,m=<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>,<span class="hljs-built_in">input</span>().split())<br>res=[]<br><span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>  a,p,s=<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>,<span class="hljs-built_in">input</span>().split())<br>  res.append((a,p,s))<br>inf=<span class="hljs-built_in">int</span>(<span class="hljs-number">1e10</span>)<br>path=[[inf]*(n+<span class="hljs-number">1</span>) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n+<span class="hljs-number">1</span>)]<br><span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m):<br>  u,v,w=<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>,<span class="hljs-built_in">input</span>().split())<br>  path[u][v]=path[v][u]=<span class="hljs-built_in">min</span>(w,path[u][v])<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>+n):<br>  path[i][i]=<span class="hljs-number">0</span><br><br><span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,n+<span class="hljs-number">1</span>):<br>  <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,n+<span class="hljs-number">1</span>):<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,n+<span class="hljs-number">1</span>):<br>      path[i][j]=<span class="hljs-built_in">min</span>(path[i][j],path[i][k]+path[k][j])<br>re=<span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,n+<span class="hljs-number">1</span>):<br>  result=<span class="hljs-number">0</span><br>  <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,n+<span class="hljs-number">1</span>):<br>    <span class="hljs-keyword">if</span> path[i][j]!=inf:<br>       result=<span class="hljs-built_in">max</span>(result,res[j-<span class="hljs-number">1</span>][<span class="hljs-number">2</span>]*res[i-<span class="hljs-number">1</span>][<span class="hljs-number">0</span>]-res[i-<span class="hljs-number">1</span>][<span class="hljs-number">0</span>]*res[i-<span class="hljs-number">1</span>][<span class="hljs-number">1</span>]-path[i][j]*res[i-<span class="hljs-number">1</span>][<span class="hljs-number">0</span>])<br>  re+=result<br><span class="hljs-built_in">print</span>(re)<br></code></pre></td></tr></table></figure>
<h2 id="Dijkstra"><a href="#Dijkstra" class="headerlink" title="Dijkstra"></a>Dijkstra</h2><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526131011122.png" alt="image-20240526131011122"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526131022596.png" alt="image-20240526131022596"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526131034522.png" alt="image-20240526131034522"></p>
<h4 id="模板题——蓝桥王国"><a href="#模板题——蓝桥王国" class="headerlink" title="模板题——蓝桥王国"></a>模板题——<a target="_blank" rel="noopener" href="https://www.lanqiao.cn/problems/1122/learning">蓝桥王国</a></h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> sys<br><br><span class="hljs-comment"># 请在此输入您的代码</span><br><span class="hljs-comment"># 1122_蓝桥王国_Dijkstra算法</span><br><span class="hljs-keyword">from</span> queue <span class="hljs-keyword">import</span> PriorityQueue  <span class="hljs-comment"># 导入优先队列</span><br><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> deque<br><br>INF = <span class="hljs-number">1e18</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">dijkstra</span>(<span class="hljs-params">s</span>):<br>    <span class="hljs-comment"># 返回从s出发到所有点的最短路</span><br>    <span class="hljs-comment"># d[i]表示从s到i的最短路</span><br>    d = [INF] * (n + <span class="hljs-number">1</span>)<br>    <span class="hljs-comment"># vis[i]表示是否出队列（注：与传统BFS不同）</span><br>    vis = [<span class="hljs-number">0</span>] * (n + <span class="hljs-number">1</span>)<br>    q = PriorityQueue()<br><br>    <span class="hljs-comment"># 1.将起点入队列，更新距离</span><br>    d[s] = <span class="hljs-number">0</span><br>    <span class="hljs-comment"># 将距离放在前面，才能对距离使用优先队列</span><br>    q.put((d[s], s))  <span class="hljs-comment"># 入队用put()</span><br>    <span class="hljs-comment"># 当队列非空</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> q.empty():  <span class="hljs-comment"># 或者写为： while len(q.queue) != 0:</span><br>        dis, u = q.get()<br>        <span class="hljs-comment"># 每个点只有第一次出队列是有用的</span><br>        <span class="hljs-keyword">if</span> vis[u]: <span class="hljs-keyword">continue</span><br>        vis[u] = <span class="hljs-number">1</span>  <span class="hljs-comment"># 出队列打标记</span><br>        <span class="hljs-comment"># 对于从u出发，到达v，权重为w的边</span><br>        <span class="hljs-keyword">for</span> v, w <span class="hljs-keyword">in</span> G[u]:<br>            <span class="hljs-keyword">if</span> d[v] &gt; d[u] + w:<br>                d[v] = d[u] + w<br>                q.put((d[v], v))<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">if</span> d[i] == INF:<br>            d[i] = -<span class="hljs-number">1</span><br>    <span class="hljs-comment"># d.pop(0)</span><br>    <span class="hljs-keyword">return</span> d[<span class="hljs-number">1</span>::] <span class="hljs-comment"># 从1到最后</span><br><br><br><span class="hljs-comment"># 皇宫编号为1</span><br><span class="hljs-comment"># 输入</span><br>n, m = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>G = [[] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n + <span class="hljs-number">1</span>)]  <span class="hljs-comment"># 图的存储：邻接表。此题N为10^5，不能用邻接矩阵存图</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m):<br>    u, v, w = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>    G[u].append((v, w))<br><span class="hljs-built_in">print</span>(*dijkstra(<span class="hljs-number">1</span>)) <span class="hljs-comment"># 列表前面加星号作用是将列表解开（unpacke）成多个独立的参数，传入函数。</span><br></code></pre></td></tr></table></figure>
<h4 id="模板题——混境之地3"><a href="#模板题——混境之地3" class="headerlink" title="模板题——混境之地3"></a>模板题——<a target="_blank" rel="noopener" href="https://www.lanqiao.cn/problems/3818/learning">混境之地3</a></h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-comment"># 3818 混境之地  Dijkstra</span><br><span class="hljs-keyword">from</span> queue <span class="hljs-keyword">import</span> PriorityQueue<br><span class="hljs-comment"># 数据较大时可以进行如下优化</span><br><span class="hljs-keyword">import</span> sys<br><span class="hljs-built_in">input</span> = sys.stdin.readline<br>INF = <span class="hljs-number">1e18</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get</span>(<span class="hljs-params">c</span>):<br>    <span class="hljs-keyword">if</span> c == <span class="hljs-string">&#x27;.&#x27;</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>    <span class="hljs-keyword">else</span>:<br>        s = <span class="hljs-string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(s)):<br>            <span class="hljs-keyword">if</span> c == s[i]:<br>                <span class="hljs-keyword">return</span> i + <span class="hljs-number">1</span><br>        <span class="hljs-comment"># return ord(c) - ord(&#x27;A&#x27;) + 1</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">dijkstra</span>():<br>    d = [[INF] * m <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n)]<br>    vis = [[<span class="hljs-number">0</span>] * m <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n)]<br>    q = PriorityQueue()  <span class="hljs-comment"># 创建优先队列</span><br>    <span class="hljs-comment"># 1.将起点塞入队列</span><br>    d[x1][y1] = <span class="hljs-number">0</span><br>    q.put((d[x1][y1], x1, y1))<br>    <span class="hljs-comment"># 2.当队列非空</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> q.empty():<br>        dis, x, y = q.get()<br>        <span class="hljs-keyword">if</span> x == x2 <span class="hljs-keyword">and</span> y == y2:<br>            <span class="hljs-keyword">return</span> dis<br>        <span class="hljs-comment"># 每个点只有第一次出队列是有用的</span><br>        <span class="hljs-keyword">if</span> vis[x][y]:<br>            <span class="hljs-keyword">continue</span><br>        vis[x][y] = <span class="hljs-number">1</span>  <span class="hljs-comment"># 出队列打标记</span><br>        <span class="hljs-keyword">for</span> d elta_x, delta_y <span class="hljs-keyword">in</span> [[<span class="hljs-number">1</span>, <span class="hljs-number">0</span>], [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>], [-<span class="hljs-number">1</span>, <span class="hljs-number">0</span>], [<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>]]:<br>            xx, yy = x + delta_x, y + delta_y<br>            <span class="hljs-comment"># 判断未越界、未标记、非障碍物</span><br>            <span class="hljs-keyword">if</span> <span class="hljs-number">0</span> &lt;= xx &lt; n <span class="hljs-keyword">and</span> <span class="hljs-number">0</span> &lt;= yy &lt; m <span class="hljs-keyword">and</span> vis[xx][yy] == <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> Map[xx][yy] != <span class="hljs-string">&quot;#&quot;</span>:<br>                <span class="hljs-keyword">if</span> d[xx][yy] &gt; d[x][y] + get(Map[xx][yy]):  <span class="hljs-comment"># 写一个get函数获取权重</span><br>                    d[xx][yy] = d[x][y] + get(Map[xx][yy])<br>                    q.put((d[xx][yy], xx, yy))<br>    <span class="hljs-keyword">return</span> INF<br><span class="hljs-comment"># 输入</span><br>n, m = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())  <span class="hljs-comment"># 地图大小</span><br>x1, y1, x2, y2 = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())  <span class="hljs-comment"># 起始点坐标</span><br>x1, y1, x2, y2 = x1 - <span class="hljs-number">1</span>, y1 - <span class="hljs-number">1</span>, x2 - <span class="hljs-number">1</span>, y2 - <span class="hljs-number">1</span><br><span class="hljs-comment"># 地图</span><br>Map = [<span class="hljs-built_in">input</span>() <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n)]<br>e = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>())  <span class="hljs-comment"># 剩余能量</span><br><span class="hljs-comment"># 如果能量支撑到达终点，返回Yes，否则，返回No.</span><br><span class="hljs-keyword">if</span> e &gt;= dijkstra():  <span class="hljs-comment"># 不传参，使用全局变量</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Yes&#x27;</span>)<br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;No&#x27;</span>)<br></code></pre></td></tr></table></figure>
<h2 id="生成树"><a href="#生成树" class="headerlink" title="生成树"></a>生成树</h2><h3 id="Kruskal"><a href="#Kruskal" class="headerlink" title="Kruskal"></a>Kruskal</h3><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526131621641.png" alt="image-20240526131621641"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526131631028.png" alt="image-20240526131631028"></p>
<h4 id="模板题——繁忙的都市"><a href="#模板题——繁忙的都市" class="headerlink" title="模板题——繁忙的都市"></a>模板题——<a target="_blank" rel="noopener" href="https://www.lanqiao.cn/problems/889/learning">繁忙的都市</a></h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">def</span> <span class="hljs-title function_">kruskal</span>():<br>    <span class="hljs-comment"># 初始化</span><br>    n, m = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>    Map = []<br>    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m):<br>        u, v, w = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>        Map.append([w, u, v])  <span class="hljs-comment"># 注意第一个参数是边权</span><br>    Map.sort()<br><br>    <span class="hljs-comment"># 并查集</span><br>    p = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(n+<span class="hljs-number">1</span>))<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">root</span>(<span class="hljs-params">x</span>):<br>        <span class="hljs-keyword">if</span> x != p[x]:<br>            p[x] = root(p[x])<br>        <span class="hljs-keyword">return</span> p[x]<br><br>    <span class="hljs-comment"># 非连环时更新</span><br>    _<span class="hljs-built_in">sum</span>, _<span class="hljs-built_in">max</span> = <span class="hljs-number">0</span>, <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> w, u, v <span class="hljs-keyword">in</span> Map:<br>        root_u = root(u)<br>        root_v = root(v)<br>        <span class="hljs-keyword">if</span> root_u != root_v:<br>            p[root_u] = root_v<br>            _<span class="hljs-built_in">sum</span> += <span class="hljs-number">1</span><br>            _<span class="hljs-built_in">max</span> = <span class="hljs-built_in">max</span>(_<span class="hljs-built_in">max</span>, w)<br>    <span class="hljs-keyword">return</span> _<span class="hljs-built_in">sum</span>, _<span class="hljs-built_in">max</span><br><span class="hljs-built_in">print</span>(*kruskal())<br></code></pre></td></tr></table></figure>
<h3 id="Prim"><a href="#Prim" class="headerlink" title="Prim"></a>Prim</h3><p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526131818064.png" alt="image-20240526131818064"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526131825567.png" alt="image-20240526131825567"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526131840546.png" alt="image-20240526131840546"></p>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526131848626.png" alt="image-20240526131848626"></p>
<h4 id="模板题——繁忙的都市-1"><a href="#模板题——繁忙的都市-1" class="headerlink" title="模板题——繁忙的都市"></a>模板题——<a target="_blank" rel="noopener" href="https://www.lanqiao.cn/problems/889/learning">繁忙的都市</a></h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> sys<br>n,m=<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>,<span class="hljs-built_in">input</span>().split())<br>e=[]<br><span class="hljs-keyword">for</span>  _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m):<br>  u,v,w=<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>,<span class="hljs-built_in">input</span>().split())<br>  e.append((w,u,v))<br><span class="hljs-comment">#边按照权重进行排序</span><br>e.sort()<br><span class="hljs-comment">#需要一个并查集</span><br>p=<span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(n+<span class="hljs-number">1</span>))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">findroot</span>(<span class="hljs-params">x</span>):<br>  <span class="hljs-keyword">if</span> x==p[x]:<span class="hljs-keyword">return</span> x<br>  <span class="hljs-keyword">else</span>:<br>    p[x]=findroot(p[x])<br>    <span class="hljs-keyword">return</span> p[x]<br>ans=<span class="hljs-number">0</span><br><span class="hljs-comment">#进行遍历所有的边，进行合并：</span><br><span class="hljs-keyword">for</span> w,u,v <span class="hljs-keyword">in</span> e:<br>  <span class="hljs-comment">#只要u和v不在同一集合内就可以进行合并：</span><br>  rootu=findroot(u)<br>  rootv=findroot(v)<br>  <span class="hljs-keyword">if</span> rootu!=rootv:<br>    p[rootu]=rootv<br>    ans=<span class="hljs-built_in">max</span>(ans,w)<br><span class="hljs-built_in">print</span>(n-<span class="hljs-number">1</span>,ans)<br></code></pre></td></tr></table></figure>
<p><img src="./../images/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/image-20240526132045604.png" alt="image-20240526132045604"></p>
 
      <!-- reward -->
      
      <div id="reword-out">
        <div id="reward-btn">
          打赏
        </div>
      </div>
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
<div class="share-btn">
      <span class="share-sns share-outer">
        <i class="ri-share-forward-line"></i>
        分享
      </span>
      <div class="share-wrap">
        <i class="arrow"></i>
        <div class="share-icons">
          
          <a class="weibo share-sns" href="javascript:;" data-type="weibo">
            <i class="ri-weibo-fill"></i>
          </a>
          <a class="weixin share-sns wxFab" href="javascript:;" data-type="weixin">
            <i class="ri-wechat-fill"></i>
          </a>
          <a class="qq share-sns" href="javascript:;" data-type="qq">
            <i class="ri-qq-fill"></i>
          </a>
          <a class="douban share-sns" href="javascript:;" data-type="douban">
            <i class="ri-douban-line"></i>
          </a>
          <!-- <a class="qzone share-sns" href="javascript:;" data-type="qzone">
            <i class="icon icon-qzone"></i>
          </a> -->
          
          <a class="facebook share-sns" href="javascript:;" data-type="facebook">
            <i class="ri-facebook-circle-fill"></i>
          </a>
          <a class="twitter share-sns" href="javascript:;" data-type="twitter">
            <i class="ri-twitter-fill"></i>
          </a>
          <a class="google share-sns" href="javascript:;" data-type="google">
            <i class="ri-google-fill"></i>
          </a>
        </div>
      </div>
</div>

<div class="wx-share-modal">
    <a class="modal-close" href="javascript:;"><i class="ri-close-circle-line"></i></a>
    <p>扫一扫，分享到微信</p>
    <div class="wx-qrcode">
      <img src="//api.qrserver.com/v1/create-qr-code/?size=150x150&data=http://zdx-1.github.io/2024/05/24/%E8%93%9D%E6%A1%A5%E5%9B%BD%E8%B5%9B%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/" alt="微信分享二维码">
    </div>
</div>

<div id="share-mask"></div>  
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%93%9D%E6%A1%A5%E6%9D%AF/" rel="tag">蓝桥杯</a></li></ul>

    </footer>
  </div>

   
  <nav class="article-nav">
    
      <a href="/2024/05/26/%E8%93%9D%E6%A1%A5%E6%9D%AF%E5%9B%BD%E8%B5%9B%E8%AF%95%E9%A2%98%E8%A7%A3%E6%9E%90/" class="article-nav-link">
        <strong class="article-nav-caption">上一篇</strong>
        <div class="article-nav-title">
          
            蓝桥杯国赛试题解析
          
        </div>
      </a>
    
    
      <a href="/2024/05/22/BookShop%E8%AF%B4%E6%98%8E%E6%96%87%E6%A1%A3/" class="article-nav-link">
        <strong class="article-nav-caption">下一篇</strong>
        <div class="article-nav-title">BookShop说明文档</div>
      </a>
    
  </nav>

  
   
  
   
    <script src="https://cdn.staticfile.org/twikoo/1.4.18/twikoo.all.min.js"></script>
    <div id="twikoo" class="twikoo"></div>
    <script>
        twikoo.init({
            envId: ""
        })
    </script>
 
</article>

</section>
      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2024
        <i class="ri-heart-fill heart_icon"></i> zdx
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
      </li>
    </ul>
  </div>
</footer>    
    </main>
    <div class="float_btns">
      <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

    </div>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/ayer-side.svg" alt="Zdx-1"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/about">关于我</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="搜索">
        <i class="ri-search-line"></i>
      </a>
      
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="/images/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="/images/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-3.6.0.min.js"></script>
 
<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->
 
<script src="/js/tocbot.min.js"></script>

<script>
  tocbot.init({
    tocSelector: ".tocbot",
    contentSelector: ".article-entry",
    headingSelector: "h1, h2, h3, h4, h5, h6",
    hasInnerContainers: true,
    scrollSmooth: true,
    scrollContainer: "main",
    positionFixedSelector: ".tocbot",
    positionFixedClass: "is-position-fixed",
    fixedSidebarOffset: "auto",
  });
</script>

<script src="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.js"></script>
<link
  rel="stylesheet"
  href="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.css"
/>
<script src="https://cdn.staticfile.org/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->
 <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/default-skin/default-skin.min.css">
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.js"></script>
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script> 
<!-- MathJax -->
 <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
      tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
  });

  MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
      for(i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
      }
  });
</script>

<script src="https://cdn.staticfile.org/mathjax/2.7.7/MathJax.js"></script>
<script src="https://cdn.staticfile.org/mathjax/2.7.7/config/TeX-AMS-MML_HTMLorMML-full.js"></script>
<script>
  var ayerConfig = {
    mathjax: true,
  };
</script>

<!-- Katex -->

<!-- busuanzi  -->

<!-- ClickLove -->
 
<script src="/js/clickLove.js"></script>
 
<!-- ClickBoom1 -->

<!-- ClickBoom2 -->

<!-- CodeCopy -->
 
<link rel="stylesheet" href="/css/clipboard.css">
 <script src="https://cdn.staticfile.org/clipboard.js/2.0.10/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>
 
<!-- CanvasBackground -->
 
<script src="/js/dz.js"></script>
 
<script>
  if (window.mermaid) {
    mermaid.initialize({ theme: "forest" });
  }
</script>


    
    
<script>
  const password = "65535";
  const lock_password = window.sessionStorage.getItem("lock_password");
  console.log(password, lock_password);
  if (lock_password !== password) {
    Swal.fire({
      title: "请输入访问密码",
      input: "text",
      inputAttributes: {
        autocapitalize: "off",
      },
      showCancelButton: false,
      showLoaderOnConfirm: true,
      allowOutsideClick: false,
      confirmButtonText: "确定",
    }).then((result) => {
      console.log(result);
      if (result.isConfirmed) {
        console.log(password);
        if (result.value === password) {
          window.sessionStorage.setItem("lock_password", result.value);
        } else {
          Swal.fire({
            icon: "error",
            title: "密码错误，请重试",
            confirmButtonText: "确定",
            allowOutsideClick: false,
          }).then(() => {
            window.location.reload();
          });
        }
      }
    });
  }
</script>


  </div>
</body>

</html>